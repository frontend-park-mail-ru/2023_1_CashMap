!function(){"use strict";var t=new class{constructor(){this.currentPage=null,this._pages={},this.rootElement=document.getElementById("root")}registerPage(t,e){this._pages[t]=e}go(t,e=!0){const s=this._getUrl(t),i=this._getSearch(t);this.currentPage&&(this.currentPage.remove(),this.currentPage.curPage=!1),this._pages[s]?(this.currentPage=this._pages[s],this.currentPage.curPage=!0,this.currentPage.showPage(i),window.location.pathname+window.location.search!==t&&(e?window.history.replaceState(null,null,t):window.history.pushState(null,null,t))):this._pages["/404"].showPage()}goBack(){window.history.back()}init(){this.go(window.location.pathname+window.location.search,!0),window.addEventListener("popstate",(()=>{this.go(window.location.pathname+window.location.search,!1)}))}_getUrl(t){const e=new URL(t,window.location.origin);return"/"===e.pathname?"/":e.pathname.replace(/\/$/,"")}_getSearch(t){const e=new URL(t,window.location.origin);return Object.fromEntries(e.searchParams)}};var e=new class{constructor(){this._callbacks=[],this._isDispatching=!1,this._pendingPayload=null}register(t){this._callbacks.push(t)}unregister(t){delete this._callbacks[t]}dispatch(t){if(this._isDispatching)throw new Error("Cannot dispatch in the middle of a dispatch");this._isDispatching=!0,this._pendingPayload=t;try{this._callbacks.forEach((t=>{t&&t(this._pendingPayload)}))}finally{this._pendingPayload=null,this._isDispatching=!1}}};var s=new class{constructor(){this.beckendStatus="global","global"===this.beckendStatus?(this.backendHostname="212.233.91.72:80",this._backendUrl="http://"+this.backendHostname):(this.backendHostname="127.0.0.1",this.backendPort="8080",this.backendStaticPort="8082",this._backendUrl="http://"+this.backendHostname+":"+this.backendPort,this._backendStaticUrl="http://"+this.backendHostname+":"+this.backendStaticPort),this._staticUrl="http://"+this.backendHostname,this._apiUrl={signIn:"/auth/sign-in",signUp:"/auth/sign-up",signOut:"/auth/logout",check:"/auth/check",getProfile:"/api/user/profile",getProfileLink:"/api/user/profile/link/",editProfile:"/api/user/profile/edit",feed:"/api/feed",userPosts:"/api/posts/profile",userPostById:"/api/posts/id",communityPosts:"/api/posts/community",createPost:"/api/posts/create",deletePost:"/api/posts/delete",editPost:"/api/posts/edit",likePost:"/api/posts/like/set",dislikePost:"/api/posts/like/cancel",getFriends:"/api/user/friends",isFriend:"/api/user/status",getNotFriends:"/api/user/rand",getUsers:"/api/user/all",getSub:"/api/user/sub",reject:"/api/user/reject",sub:"/api/user/sub",unsub:"/api/user/unsub",getGroups:"/api/group/self",getGroupInfo:"/api/group/link/",editGroup:"/api/group/link/",deleteGroup:"/api/group/link/",getManageGroups:"/api/group/manage",getNotGroups:"/api/group/hot",getPopularGroups:"/api/group/hot",createGroup:"/api/group/create",getGroupsSub:"/api/group/link/",GroupsSub:"/api/group/link/",GroupsUnsub:"/api/group/link/",chatCheck:"/api/im/chat/check",chatCreate:"/api/im/chat/create",getChats:"/api/im/chats",getMsg:"/api/im/messages",sendMsg:"/api/im/send",uploadImg:"/static-service/upload",deleteImg:"/static-service/delete",downloadImg:"/static-service/download",userSearch:"/api/user/search",getComments:"/api/comment/post/",getComment:"/api/comment/",createComment:"/api/comment/create",deleteComment:"/api/comment/delete/",editComment:"/api/comment/edit",getStickerPackInfo:"/api/sticker/pack/info",getStickerPacksByAuthor:"/api/sticker/pack/author",notifiesCount:"/api/im/unread",msgRead:"/api/im/set-read"},this._requestType={GET:"GET",POST:"POST",DELETE:"DELETE",PATCH:"PATCH"}}_request(t,e,s){let i=null;i="local"===this.beckendStatus&&t===this._apiUrl.uploadImg?this._backendStaticUrl+t:this._backendUrl+t;let a={};return a["X-Csrf-Token"]=localStorage.getItem("X-Csrf-Token"),"DELETE"!==e&&"/api/im/chat/create"!==t&&t!==this._apiUrl.editGroup&&t!==this._apiUrl.sendMsg&&t!==this._apiUrl.editPost&&"/api/posts/like/set"!==t&&"/api/posts/like/cancel"!==t&&t!==this._apiUrl.likePost&&t!==this._apiUrl.dislikePost||(a["Content-Type"]="application/json"),fetch(i,{method:e,mode:"cors",credentials:"include",headers:a,body:s})}async signIn(t,e){let s={email:t,password:e};return this._request(this._apiUrl.signIn,this._requestType.POST,JSON.stringify({body:s}))}async signUp(t,e,s,i){let a={first_name:t,last_name:e,email:s,password:i};return this._request(this._apiUrl.signUp,this._requestType.POST,JSON.stringify({body:a}))}async signOut(){return this._request(this._apiUrl.signOut,this._requestType.POST)}async getProfile(t){return t?this._request(this._apiUrl.getProfileLink+t,this._requestType.GET):this._request(this._apiUrl.getProfile,this._requestType.GET)}async editProfile(t,e,s,i,a,r){const n={avatar_url:t,first_name:e,last_name:s,bio:i,birthday:a,status:r};return this._request(this._apiUrl.editProfile,this._requestType.PATCH,JSON.stringify({body:n}))}async checkAuth(){return this._request(this._apiUrl.check,this._requestType.GET)}async getPosts(t,e,s){return s?this._request(this._apiUrl.userPosts+`?owner_link=${t}&batch_size=${e}&last_post_date=${s}`,this._requestType.GET):this._request(this._apiUrl.userPosts+`?owner_link=${t}&batch_size=${e}`,this._requestType.GET)}async getPostsByCommunity(t,e,s){return s?this._request(this._apiUrl.communityPosts+`?community_link=${t}&batch_size=${e}&last_post_date=${s}`,this._requestType.GET):this._request(this._apiUrl.communityPosts+`?community_link=${t}&batch_size=${e}`,this._requestType.GET)}async getFriendsPosts(t,e){return e?this._request(this._apiUrl.feed+`?&batch_size=${t}&last_post_date=${e}`,this._requestType.GET):this._request(this._apiUrl.feed+`?&batch_size=${t}`,this._requestType.GET)}async getPostById(t,e,s){return s?this._request(this._apiUrl.userPostById+`?post_id=${t}&batch_size=${e}&last_post_date=${s}`,this._requestType.GET):this._request(this._apiUrl.userPostById+`?post_id=${t}&batch_size=${e}`,this._requestType.GET)}async createPost(t){let e=t;return this._request(this._apiUrl.createPost,this._requestType.POST,JSON.stringify({body:e}))}async editPost(t,e,s,i){const a={text:t,post_id:Number(i),attachments:{deleted:e,added:s}};return this._request(this._apiUrl.editPost,this._requestType.PATCH,JSON.stringify(a))}async deletePost(t){const e={post_id:t};return this._request(this._apiUrl.deletePost,this._requestType.DELETE,JSON.stringify({body:e}))}async getFriends(t,e,s=0){return this._request(this._apiUrl.getFriends+`?link=${t}&limit=${e}&offset=${s}`,this._requestType.GET)}async isFriend(t){return this._request(this._apiUrl.isFriend+`?link=${t}`,this._requestType.GET)}async getNotFriends(t,e,s=0){return this._request(this._apiUrl.getNotFriends+`?limit=${e}&offset=${s}`,this._requestType.GET)}async getUsers(t,e=0){return this._request(this._apiUrl.getUsers+`?limit=${t}&offset=${e}`,this._requestType.GET)}async getSub(t,e,s,i=0){return this._request(this._apiUrl.getSub+`?type=${t}&link=${e}&limit=${s}&offset=${i}`,this._requestType.GET)}async reject(t){const e={user_link:t};return this._request(this._apiUrl.reject,this._requestType.POST,JSON.stringify({body:e}))}async getGroups(t,e=0){return this._request(this._apiUrl.getGroups+`?limit=${t}&offset=${e}`,this._requestType.GET)}async groupSub(t){return this._request(this._apiUrl.GroupsSub+t+"/sub",this._requestType.POST)}async groupUnsub(t){return this._request(this._apiUrl.GroupsUnsub+t+"/unsub",this._requestType.POST)}async getGroupInfo(t){return this._request(this._apiUrl.getGroupInfo+t,this._requestType.GET)}async getGroupsSub(t,e,s=0){return this._request(this._apiUrl.getGroupsSub+t+"/subs"+`?limit=${e}&offset=${s}`,this._requestType.GET)}async editGroup(t,e,s,i,a,r){const n={title:e,group_info:s,avatar_url:i,privacy:a,hide_owner:r};return this._request(this._apiUrl.editGroup+t,this._requestType.PATCH,JSON.stringify({body:n}))}async deleteGroup(t){return this._request(this._apiUrl.deleteGroup+t,this._requestType.DELETE)}async getmanageGroups(t,e=0){return this._request(this._apiUrl.getManageGroups+`?limit=${t}&offset=${e}`,this._requestType.GET)}async getNotGroups(t,e=0){return this._request(this._apiUrl.getNotGroups+`?limit=${t}&offset=${e}`,this._requestType.GET)}async getPopularGroups(t,e=0){return this._request(this._apiUrl.getPopularGroups+`?limit=${t}&offset=${e}`,this._requestType.GET)}async createGroup(t,e,s,i){const a={title:t,group_info:e,privacy:s,hide_owner:i};return this._request(this._apiUrl.createGroup,this._requestType.POST,JSON.stringify({body:a}))}async sub(t){const e={user_link:t};return this._request(this._apiUrl.sub,this._requestType.POST,JSON.stringify({body:e}))}async unsub(t){const e={user_link:t};return this._request(this._apiUrl.unsub,this._requestType.POST,JSON.stringify({body:e}))}async getChats(t=0,e=0){return this._request(this._apiUrl.getChats+`?batch_size=${t}&last_msg_date=${e}`,this._requestType.GET)}async getChatsMsg(t,e,s){return s?this._request(this._apiUrl.getMsg+`?chat_id=${t}&batch_size=${e}&last_msg_date=${s}`,this._requestType.GET):this._request(this._apiUrl.getMsg+`?chat_id=${t}&batch_size=${e}`,this._requestType.GET)}async chatCheck(t){return this._request(this._apiUrl.chatCheck+`?user_link=${t}`,this._requestType.GET)}async msgSend(t,e,s,i){let a;return a=s?{chat_id:Number(t),text_content:e,message_content_type:"sticker",sticker_id:s,attachments:i}:{chat_id:Number(t),text_content:e,attachments:i},this._request(this._apiUrl.sendMsg,this._requestType.POST,JSON.stringify({body:a}))}async chatCreate(t){const e={user_links:[t]};return this._request(this._apiUrl.chatCreate,this._requestType.POST,JSON.stringify({body:e}))}async uploadImg(t,e){let s=new FormData;return s.append("attachments",t),e?this._request(this._apiUrl.uploadImg+`?filename=${e}`,this._requestType.POST,s,this._staticUrl):this._request(this._apiUrl.uploadImg,this._requestType.POST,s,this._staticUrl)}async getGlobalSearchResult(t,e,s){let i=this._apiUrl.userSearch+`?search_query=${t}&batch_size=${e}&offset=${s}`;return this._request(i,this._requestType.GET)}async likePost(t){const e={post_id:t};return this._request(this._apiUrl.likePost,this._requestType.POST,JSON.stringify({body:e}))}async dislikePost(t){const e={post_id:t};return this._request(this._apiUrl.dislikePost,this._requestType.POST,JSON.stringify({body:e}))}imgUrlConvert(t){return"local"===this.beckendStatus?`http://${this.backendHostname}:${this.backendStaticPort}/${t}`:`http://${this.backendHostname}/${t}`}imgUrlBackConvert(t){return"local"===this.beckendStatus?t.replace(`http://${this.backendHostname}:${this.backendStaticPort}/`,""):t.replace(`http://${this.backendHostname}/`,"")}stickerUrlConvert(t){return"local"===this.beckendStatus?`http://${this.backendHostname}:${this.backendStaticPort}/static-service/download?name=${t}&type=sticker`:`http://${this.backendHostname}/static-service/download?name=${t}&type=sticker`}async getCommentsByPostId(t,e,s){let i=null!=s?`last_comment_date=${s}`:"",a=null!=e?`batch_size=${e}`:"";return this._request(this._apiUrl.getComments+t+`?${i}&${a}`,this._requestType.GET)}async getCommentById(t){return this._request(this._apiUrl.getComment+t,this._requestType.GET)}async createComment(t,e,s){const i={post_id:t,reply_to:e,text:s};return this._request(this._apiUrl.createComment,this._requestType.POST,JSON.stringify({body:i}))}async editComment(t,e){const s={id:t,text:e};return this._request(this._apiUrl.editComment,this._requestType.PATCH,JSON.stringify({body:s}))}async deleteComment(t){return this._request(this._apiUrl.deleteComment+t,this._requestType.POST)}async getStickerPackInfo(t){return this._request(this._apiUrl.getStickerPackInfo+`?pack_id=${t}`,this._requestType.GET)}async getStickerPacksByAuthor(t,e,s=void 0){return s?this._request(this._apiUrl.getStickerPacksByAuthor+`?author=${s}&limit=${t}&offset=${e}&offset=${e}`,this._requestType.GET):this._request(this._apiUrl.getStickerPacksByAuthor+`?limit=${t}&offset=${e}`,this._requestType.GET)}async notifiesCount(){return this._request(this._apiUrl.notifiesCount,this._requestType.GET)}async msgRead(t,e){const s={chat_id:Number(t),time:e};return this._request(this._apiUrl.msgRead,this._requestType.POST,JSON.stringify({body:s}))}};const i="#B95DD9",a=150,r="2017-01-01",n="static/img/post_icons/group_image.svg",o=[".png",".jpeg",".jpg",".gif",".webp"],l={logoImgPath:"static/img/logo.svg",logoText:"Depeche",menuItemList:[{text:"Моя страница",jsId:"js-side-bar-my-page",iconPath:"static/img/nav_icons/profile.svg",hoveredIconPath:"static/img/nav_icons/profile_hover.svg"},{text:"Новости",jsId:"js-side-bar-news",iconPath:"static/img/nav_icons/news.svg",hoveredIconPath:"static/img/nav_icons/news_hover.svg"},{text:"Мессенджер",jsId:"js-side-bar-msg",iconPath:"static/img/nav_icons/messenger.svg",hoveredIconPath:"static/img/nav_icons/messenger_hover.svg",jsIdNotifies:"js-msg-notifies",notifies:""},{text:"Друзья",jsId:"js-side-bar-friends",iconPath:"static/img/nav_icons/friends.svg",hoveredIconPath:"static/img/nav_icons/friends_hover.svg"},{text:"Сообщества",jsId:"js-side-bar-groups",iconPath:"static/img/nav_icons/groups.svg",hoveredIconPath:"static/img/nav_icons/groups_hover.svg"}]},d={avatarDefault:"static/img/post_icons/profile_image.svg",exitButton:{text:"Выход",jsId:"js-exit-btn",iconPath:"static/img/exit.svg",hoveredIconPath:"static/img/exit_hover.svg"},settingsButton:{text:"Настройки",jsId:"js-settings-btn",iconPath:"static/img/settings.svg",hoveredIconPath:"static/img/settings_hover.svg"}},c={logoImgPath:"static/img/logo.svg",backgroundImgPath:"static/img/background_right.svg",logoText:"Depeche",logoTagline:"Твоя социальная сеть"},h={logoImgPath:"static/img/logo.svg",backgroundImgPath:"static/img/background_left.svg",logoText:"Depeche",logoTagline:"Твоя социальная сеть"},u={title:"Авторизация",inputFields:[{text:"",help:"Электронная почта",type:"email",jsIdInput:"js-email-input",jsIdError:"js-email-error"},{text:"",help:"Пароль",type:"password",jsIdInput:"js-password-input",jsIdError:"js-password-error"}],buttonInfo:{text:"Войти",jsId:"js-sign-in-btn"},errorInfo:{jsId:"js-sign-in-error"},link:{text:"У вас еще нет аккаунта? Зарегистрироваться",jsId:"js-create-account-btn"},linkInfo:"После успешной регистрации вы получите доступ ко всем функциям Depeche"},m={title:"Регистрация",inputFields:[{help:"Имя",type:"text",jsIdInput:"js-first-name-input",jsIdError:"js-first-name-error"},{help:"Фамилия",type:"text",jsIdInput:"js-last-name-input",jsIdError:"js-last-name-error"},{help:"Электронная почта",type:"email",jsIdInput:"js-email-input",jsIdError:"js-email-error"},{help:"Пароль",type:"password",jsIdInput:"js-password-input",jsIdError:"js-password-error"},{help:"Повторите пароль",type:"password",jsIdInput:"js-repeat-password-input",jsIdError:"js-repeat-password-error"}],buttonInfo:{text:"Зарегистрироваться",jsId:"js-sign-up-btn"},errorInfo:{jsId:"js-sign-up-error"},link:{text:"У вас уже есть аккаунт? Войти",jsId:"js-have-account-btn"}},g={avatar_url:"static/img/post_icons/profile_image.svg",inputFields:[{help:"Имя",data:"",type:"text",jsIdInput:"js-first-name-input",jsIdError:"js-first-name-error"},{help:"Фамилия",data:"",type:"text",jsIdInput:"js-last-name-input",jsIdError:"js-last-name-error"},{help:"О себе",data:"",type:"text",jsIdInput:"js-bio-input",jsIdError:"js-bio-error"},{help:"Дата рождения",data:"",type:"date",jsIdInput:"js-birthday-input",jsIdError:"js-birthday-error"},{help:"Статус",data:"",type:"text",jsIdInput:"js-status-input",jsIdError:"js-status-error"}],buttonInfo:{text:"Сохранить",jsId:"js-settings-save-btn"},errorInfo:{jsId:"js-sign-in-error"},menuInfo:[{text:"Основные",jsId:"js-menu-main"}]},_={header:"Смена пароля",inputFields:[{help:"Введите старый пароль",type:"text",jsIdInput:"js-password-input",jsIdError:"js-password-error"},{help:"Введите новый пароль",type:"text",jsIdInput:"js-new-password-input",jsIdError:"js-new-password-error"},{help:"Повторите пароль",type:"email",jsIdInput:"js-repeat-password-input",jsIdError:"js-repeat-password-error"}],buttonInfo:{text:"Изменить пароль",jsId:"js-change-password-btn"},menuInfo:[{text:"Основные",jsId:"js-menu-main"},{text:"Безопасность",jsId:"js-menu-safety"}]},p=[{text:"Друзья",jsId:"js-menu-friends"},{text:"Подписчики",jsId:"js-menu-subscribers"},{text:"Подписки",jsId:"js-menu-subscriptions"},{text:"Поиск друзей",jsId:"js-menu-find-friends"}],f={emptyQueryTitle:"Ваш запрос не дал результатов",showMoreTitle:"Показать все результаты",peopleSectionTitle:"Люди",communitySectionTitle:"Сообщества",sendMessageIconPath:"static/img/messenger.svg",sendMessageHoveredIconPath:"static/img/messenger_hover.svg",showMoreIconPath:"static/img/show_all.svg",showMoreIconPathHover:"static/img/show_all_hover.svg"},b={menuInfo:[{text:"Мои сообщества",jsId:"js-menu-groups"},{text:"Управление",jsId:"js-menu-manage-groups"},{text:"Поиск сообществ",jsId:"js-menu-find-groups"}],buttonInfo:{text:"Создать сообщество",jsId:"js-create-group-btn"}},y={inputInfo:{help:"Название",type:"text",jsIdInput:"js-title-input",jsIdError:"js-title-error"},buttonInfo:{text:"Создать сообщество",jsId:"js-add-group-btn"}},v={avatar_url:"static/img/post_icons/group_image.svg",inputInfo:{help:"Название",data:"",type:"text",jsIdInput:"js-title-input",jsIdError:"js-title-error"},info:"",type:"",showAuthor:"",buttonInfo:{text:"Сохранить",jsId:"js-settings-save-btn"},menuInfo:[{text:"Настройки",jsId:"js-menu-main"}],errorInfo:{jsId:"js-sign-in-error"},buttonDelete:{text:"Удалить группу",jsId:"js-delete-group-btn"},buttonGoToGroup:{text:"Вернуться в сообщество",jsId:"js-go-to-group-btn"},deleteGroupData:{text:"Да",jsId:"js-group-delete-btn"}},k={smiles:[{text:"😀"},{text:"😃"},{text:"😄"},{text:"😁"},{text:"😅"},{text:"😆"},{text:"😂"},{text:"🤣"},{text:"😉"},{text:"😊"},{text:"🙂"},{text:"🙃"},{text:"😇"},{text:"😗"},{text:"😙"},{text:"😚"},{text:"😘"},{text:"😍"},{text:"🥰"},{text:"🤩"},{text:"🤗"},{text:"😋"},{text:"😜"},{text:"🤪"},{text:"😛"},{text:"😝"},{text:"🤑"},{text:"🤭"},{text:"🤐"},{text:"🤫"},{text:"😶"},{text:"🤔"},{text:"🤨"},{text:"🧐"},{text:"😐"},{text:"😑"},{text:"🙄"},{text:"😬"},{text:"🤥"},{text:"😏"},{text:"😌"},{text:"🤤"},{text:"😴"},{text:"🤓"},{text:"😎"},{text:"🥳"},{text:"🤠"},{text:"😒"},{text:"😔"},{text:"😪"},{text:"😕"},{text:"😟"},{text:"🙁"},{text:"😮"},{text:"😯"},{text:"😲"},{text:"😳"},{text:"🥺"},{text:"😦"},{text:"😧"},{text:"😨"},{text:"😰"},{text:"😥"},{text:"😢"},{text:"😭"},{text:"😱"},{text:"😖"},{text:"😣"},{text:"😞"},{text:"😓"},{text:"😩"},{text:"😫"},{text:"😷"},{text:"🤒"},{text:"🤕"},{text:"🤢"},{text:"🤮"},{text:"🤧"},{text:"🥶"},{text:"🥵"},{text:"🥴"},{text:"😵"},{text:"🤯"},{text:"😤"},{text:"😠"},{text:"😡"},{text:"🤬"},{text:"😈"},{text:"👿"},{text:"💀"},{text:"☠"},{text:"💩"},{text:"🤡"},{text:"👹"},{text:"👺"},{text:"👻"},{text:"👽"},{text:"👾"},{text:"🤖"},{text:"😺"},{text:"😸"},{text:"😹"},{text:"😻"},{text:"😼"},{text:"😽"},{text:"🙀"},{text:"😿"},{text:"😾"},{text:"🙈"},{text:"🙉"},{text:"🙊"},{text:"🦠"},{text:"❤️"}]},E={signIn(t){e.dispatch({actionName:"signIn",data:t})},signUp(t){e.dispatch({actionName:"signUp",data:t})},signOut(){e.dispatch({actionName:"signOut"})},getProfile(t,s){e.dispatch({actionName:"getProfile",callback:t,link:s})},checkAuth(t){e.dispatch({actionName:"checkAuth",callback:t})},editProfile(t){e.dispatch({actionName:"editProfile",data:t})}},P={getGroups(t,s,i=!1){e.dispatch({actionName:"getGroups",count:t,offset:s,isScroll:i})},getmanageGroups(t,s,i=!1){e.dispatch({actionName:"getManageGroups",count:t,offset:s,isScroll:i})},getNotGroups(t,s,i=!1){e.dispatch({actionName:"getNotGroups",count:t,offset:s,isScroll:i})},getPopularGroups(t,s,i=!1){e.dispatch({actionName:"getPopularGroups",count:t,offset:s,isScroll:i})},groupSub(t){e.dispatch({actionName:"groupSub",link:t})},groupUnsub(t){e.dispatch({actionName:"groupUnsub",link:t})},getGroupInfo(t,s){e.dispatch({actionName:"getGroupInfo",callback:t,link:s})},createGroup(t){e.dispatch({actionName:"createGroup",data:t})},editGroup(t){e.dispatch({actionName:"editGroup",data:t})},deleteGroup(t){e.dispatch({actionName:"deleteGroup",link:t})},getGroupsSub(t,s,i){e.dispatch({actionName:"getGroupsSub",link:t,count:s,offset:i})}};var I=new class{constructor(){this._callbacks=[],this.groups=[],this.manageGroups=[],this.findGroups=[],this.popularGroups=[],this.curGroup={},this.editMsg="",this.editStatus=null,this.error="",this.hasNextGroups=!0,this.hasNextManagedGroups=!0,this.hasNextGroups=!0,this.hasNextFoundGroups=!0,e.register(this._fromDispatch.bind(this))}registerCallback(t){this._callbacks.push(t)}_refreshStore(){this._callbacks.forEach((t=>{t&&t()}))}async _fromDispatch(t){switch(t.actionName){case"getGroups":await this._getGroups(t.count,t.offset,t.isScroll);break;case"getManageGroups":await this._getManageGroups(t.count,t.offset,t.isScroll);break;case"getNotGroups":await this._getNotGroups(t.count,t.offset,t.isScroll);break;case"getPopularGroups":await this._getPopularGroups(t.count,t.offset,t.isScroll);break;case"getGroupInfo":await this._getGroupInfo(t.callback,t.link);break;case"createGroup":await this._createGroup(t.data);break;case"editGroup":await this._editGroup(t.data);break;case"deleteGroup":await this._deleteGroup(t.link);break;case"getGroupsSub":await this._getGroupsSub(t.link,t.count,t.offset);break;case"groupSub":await this._groupSub(t.link);break;case"groupUnsub":await this._groupUnsub(t.link);break;default:return}}async _getGroups(t,e,i=!1){const a=await s.getGroups(t,e),r=await a.json();200===a.status?(r.body.groups&&0!==r.body.groups.length?(this.hasNextGroups=!0,r.body.groups.forEach((t=>{t.isGroup=!0,t.avatar_url?t.avatar_url=s.imgUrlConvert(t.avatar_url):t.avatar_url=n,"open"===t.privacy?t.privacy="Открытая группа":t.privacy="Закрытая группа"}))):this.hasNextGroups=!1,i?this.groups.push(...r.body.groups):this.groups=r.body.groups):401===a.status?E.signOut():alert("error"),this._refreshStore()}async _getManageGroups(t,e,i=!1){const a=await s.getmanageGroups(t,e),r=await a.json();200===a.status?(r.body.groups&&0!==r.body.groups.length?(this.hasNextManagedGroups=!0,r.body.groups.forEach((t=>{t.isUserGroup=!0,t.avatar_url?t.avatar_url=s.imgUrlConvert(t.avatar_url):t.avatar_url=n,"open"===t.privacy?t.privacy="Открытая группа":t.privacy="Закрытая группа"}))):this.hasNextManagedGroups=!1,i?this.manageGroups.push(...r.body.groups):this.manageGroups=r.body.groups):401===a.status?E.signOut():alert("error"),this._refreshStore()}async _getNotGroups(t,e,i=!1){const a=await s.getNotGroups(t,e),r=await a.json();200===a.status?(r.body.groups&&0!==r.body.groups.length?(this.hasNextFoundGroups=!0,r.body.groups.forEach((t=>{t.isNotUserGroup=!0,t.avatar_url?t.avatar_url=s.imgUrlConvert(t.avatar_url):t.avatar_url=n,"open"===t.privacy?t.privacy="Открытая группа":t.privacy="Закрытая группа"}))):this.hasNextFoundGroups=!1,i?this.findGroups.push(...r.body.groups):this.findGroups=r.body.groups):401===a.status?E.signOut():alert("error"),this._refreshStore()}async _getPopularGroups(t,e,i=!1){const a=await s.getPopularGroups(t,e),r=await a.json();200===a.status?(r.body.groups.forEach((t=>{t.isPopularGroup=!0,t.avatar_url?t.avatar_url=s.imgUrlConvert(t.avatar_url):t.avatar_url=n,"open"===t.privacy?t.privacy="Открытая группа":t.privacy="Закрытая группа"})),this.popularGroups=r.body.groups):401===a.status?E.signOut():alert("error"),this._refreshStore()}async _getGroupInfo(e,i){const a=await s.getGroupInfo(i),r=await a.json();200===a.status?(this.curGroup=r.body.group_info,this.curGroup.isSub=r.body.is_sub,this.curGroup.isAdmin=r.body.is_admin,this.curGroup.management[0].avatar?this.curGroup.management[0].avatar_url=s.imgUrlConvert(this.curGroup.management[0].avatar):this.curGroup.management[0].avatar_url=d.avatarDefault,this.curGroup.management[0].link&&(this.curGroup.management[0].user_link=this.curGroup.management[0].link),this.curGroup.management=this.curGroup.management[0],this.curGroup.avatar_url?this.curGroup.avatar_url=s.imgUrlConvert(this.curGroup.avatar_url):this.curGroup.avatar_url=n):401===a.status?E.signOut():404===a.status?t.go("/404"):alert("getGroup error"),e&&e(),this._refreshStore()}async _getGroupsSub(t,e,i){const a=await s.getGroupsSub(t,e,i),r=await a.json();200===a.status?(r.body.profiles.forEach((t=>{t.avatar_url?t.avatar_url=s.imgUrlConvert(t.avatar_url):t.avatar_url=d.avatarDefault})),this.curGroup.subList=r.body.profiles):401===a.status?E.signOut():alert("getGroup error"),this._refreshStore()}async _createGroup(t){const e=await s.createGroup(t.title,t.info,t.privacy,t.hideOwner);if(200===e.status){const e={};e.title=t.title,e.info=t.info,e.privacy=t.privacy,e.hideOwner=t.hideOwner,this.manageGroups.push(e)}else 401===e.status?E.signOut():400===e.status?this.error=e.body.message:alert("createGroup error");this._refreshStore()}async _editGroup(t){const e=await s.editGroup(t.link,t.title,t.info,t.avatar,t.privacy,t.hideOwner);200===e.status?(t.avatar&&(this.curGroup.avatar_url=this.curGroup.avatar_url=s.imgUrlConvert(t.avatar)),this.curGroup.link=t.link,this.curGroup.title=t.title,this.curGroup.info=t.info,this.curGroup.privacy=t.privacy,this.curGroup.hideOwner=t.hideOwner,this.editMsg="Данные профиля успешно обновлены",this.editStatus=!0):401===e.status?E.signOut():(this.editMsg="Ошибка сервера",this.editStatus=!1),this._refreshStore()}async _deleteGroup(t){const e=await s.deleteGroup(t);if(200===e.status)for(let e=0;e<this.manageGroups.length;e++)this.manageGroups[e].link===t&&this.manageGroups.slice(e,1);else 401===e.status?E.signOut():alert("editGroup error");this._refreshStore()}async _groupSub(t){const e=await s.groupSub(t);200===e.status?this.curGroup.isSub=!0:401===e.status?E.signOut():alert("groupSub error"),this._refreshStore()}async _groupUnsub(t){const e=await s.groupUnsub(t);200===e.status?(this.curGroup.isSub=!1,P.getGroups(15,0)):401===e.status?E.signOut():alert("groupUnsub error"),this._refreshStore()}};var B=new class{constructor(){}fromBackToPost(t){const e=new Date(t),s=new Date,i=new Date;i.setDate(s.getDate()-1);const a=new Date;a.setDate(s.getDate()-2);let r=null;return r=e.getDate()===s.getDate()?new Date(t).toLocaleTimeString().split(":").slice(0,2).join(":"):e.getDate()===i.getDate()?"вчера в "+new Date(t).toLocaleTimeString().split(":").slice(0,2).join(":"):e.getDate()===a.getDate()?"позавчера":new Date(e).toLocaleDateString(),r}fromBackToMsg(t){const e=new Date(t),s=new Date,i=new Date;i.setDate(s.getDate()-1);const a=new Date;a.setDate(s.getDate()-2);let r=null;return r=e.getDate()===s.getDate()?new Date(t).toLocaleTimeString().split(":").slice(0,2).join(":"):e.getDate()===i.getDate()?"вчера":e.getDate()===a.getDate()?"позавчера":new Date(e).toLocaleDateString(),r}};class w{constructor(){this._callbacks=[],this.posts=[],this.attachments=[],this.deleteAttachments=[],this.addAttachments=[],this.text="",this.editError="",this.curPost=null,this.comments=new Map,this.haveCommentsContinuation=new Map,this.currentComment=null,this.hasMorePosts=!0,e.register(this._fromDispatch.bind(this))}registerCallback(t){this._callbacks.push(t)}_refreshStore(){this._callbacks.forEach((t=>{t&&t()}))}async _fromDispatch(t){switch(t.actionName){case"getPosts":await this._getPosts(t.userLink,t.count,t.lastPostDate,t.isScroll);break;case"getFeedPosts":await this._getFeedPosts(t.count,t.lastPostDate,t.isScroll);break;case"getPostById":await this._getPostsById(t.id,t.count,t.lastPostDate);break;case"getPostsByCommunity":await this._getPostsByCommunity(t.community_link,t.count,t.lastPostDate,t.isScroll);break;case"createPost":await this._createPost(t.data);break;case"deletePost":await this._deletePost(t.postId);break;case"editPost":await this._editPost(t.text,t.postId);break;case"likePost":await this._likePost(t.postId);break;case"dislikePost":await this._dislikePost(t.postId);break;case"getComment":await this.getCommentById(t.id);break;case"getComments":await this.getCommentsByPostId(t.postID,t.count,t.lastCommentDate);break;case"createComment":await this.createComment(t.postID,t.replyTo,t.text);break;case"deleteComment":await this.deleteComment(t.id);break;case"editComment":await this.editComment(t.id,t.text);break;default:return}}async _getPosts(e,i,a,r=!1){const n=await s.getPosts(e,i,a);if(200===n.status){const e=await n.json();e.body.posts&&0!==e.body.posts.length?(this.hasMorePosts=!0,e.body.posts.forEach((e=>{if(e.canDelite=e.canEdit=!1,e.author_link===N.user.user_link?e.canDelite=e.canEdit=!0:e.owner_info.user_link===N.user.user_link&&(e.canDelite=!0),e.owner_info.avatar_url?e.owner_info.avatar_url=s.imgUrlConvert(e.owner_info.avatar_url):e.owner_info.avatar_url=d.avatarDefault,e.comments||(e.comments_count=0),e.creation_date){const t=new Date(e.creation_date);e.raw_creation_date=e.creation_date.replace("+","%2B"),e.creation_date=B.fromBackToPost(t)}if(e.avatar_url=N.userProfile.avatar_url,e.attachments)for(let i=0;i<e.attachments.length;i++){const a=e.attachments[i];let r=t._getSearch(a).type;"img"!==r&&(r="file"),e.attachments[i]={url:s.imgUrlConvert(a),id:i+1,type:r},t._getSearch(a).filename&&(e.attachments[i].filename=t._getSearch(a).filename)}}))):this.hasMorePosts=!1,r?this.posts.push(...e.body.posts):this.posts=e.body.posts}else 401===n.status?E.signOut():alert("getPosts error");this._refreshStore()}async _getFeedPosts(e,i,a=!1){const r=await s.getFriendsPosts(e,i);if(200===r.status){const e=await r.json();e.body.posts&&0!==e.body.posts.length?(this.hasMorePosts=!0,e.body.posts.forEach((e=>{if(e.canDelite=e.canEdit=!1,e.author_link===N.user.user_link?e.canDelite=e.canEdit=!0:e.owner_info.user_link===N.user.user_link&&(e.canDelite=!0),e.owner_info.avatar_url?e.owner_info.avatar_url=s.imgUrlConvert(e.owner_info.avatar_url):e.owner_info.avatar_url=d.avatarDefault,e.community_info&&(e.community_info.avatar_url?e.community_info.avatar_url=s.imgUrlConvert(e.community_info.avatar_url):e.community_info.avatar_url=n),e.creation_date){const t=new Date(e.creation_date);e.raw_creation_date=e.creation_date.replace("+","%2B"),e.creation_date=B.fromBackToPost(t)}if(e.avatar_url=N.user.avatar_url,e.attachments)for(let i=0;i<e.attachments.length;i++){const a=e.attachments[i];let r=t._getSearch(a).type;"img"!==r&&(r="file"),e.attachments[i]={url:s.imgUrlConvert(a),id:i+1,type:r},t._getSearch(a).filename&&(e.attachments[i].filename=t._getSearch(a).filename)}}))):this.hasMorePosts=!1,a?this.posts.push(...e.body.posts):this.posts=e.body.posts}else 401===r.status?E.signOut():alert("getPosts error");this._refreshStore()}async getCommentsByPostId(t,e,i){const a=await s.getCommentsByPostId(t,e,i);if(200===a.status){const e=await a.json();if(null===e.body.comments)return void this.haveCommentsContinuation.set(t,e.body.has_next);e.body.comments.forEach((t=>{null===t.sender_info.avatar_url?t.sender_info.avatar_url=d.avatarDefault:t.sender_info.avatar_url=s.imgUrlConvert(t.sender_info.avatar_url),t.raw_creation_date=t.creation_date.replace("+","%2B"),t.creation_date=B.fromBackToPost(t.creation_date),t.change_date=B.fromBackToPost(t.change_date)})),this.comments.has(t)?this.comments.get(t).push(...e.body.comments):this.comments.set(t,e.body.comments),this.haveCommentsContinuation.set(t,e.body.has_next)}else 401===a.status?E.signOut():alert("get comments error");this._refreshStore()}async getCommentById(t){const e=await s.getCommentById(t);if(200===e.status){const t=await e.json();this.currentComment=t.body.comment}else 401===e.status?E.signOut():alert("get comment error");this._refreshStore()}async createComment(t,e,i){const a=await s.createComment(t,e,i);if(200===a.status){await a.json();for(let e of this.posts)e.id===t&&(e.comments_amount+=1);void 0!==this.comments.get(t)&&this.comments.delete(t),await this.getCommentsByPostId(t)}else 401===a.status?E.signOut():alert("create comment error");this._refreshStore()}async editComment(t,e){const i=await s.editComment(t,e);401===i.status?E.signOut():200!==i.status&&alert("edit comment error"),this._refreshStore()}async deleteComment(t){const e=await s.deleteComment(t);401===e.status?E.signOut():200!==e.status&&alert("delete comment error"),this._refreshStore()}async _getPostsById(e,i,a){const r=await s.getPostById(e,i,a);if(200===r.status){const e=await r.json();if(e.body.posts[0].attachments)for(let i=0;i<e.body.posts[0].attachments.length;i++){const a=e.body.posts[0].attachments[i];let r=t._getSearch(a).type;"img"!==r&&(r="file"),e.body.posts[0].attachments[i]={url:s.imgUrlConvert(a),id:i+1,type:r},t._getSearch(a).filename&&(e.body.posts[0].attachments[i].filename=t._getSearch(a).filename)}this.curPost=e.body.posts[0],this.attachments=e.body.posts[0].attachments}else 401===r.status?E.signOut():alert("getPostById error");this._refreshStore()}async _getPostsByCommunity(e,i,a,r=!1){const o=await s.getPostsByCommunity(e,i,a);if(200===o.status){const e=await o.json();e.body.posts&&0!==e.body.posts.length?(this.hasMorePosts=!0,e.body.posts.forEach((e=>{if(e.canDelite=e.canEdit=!1,I.curGroup.management.link===N.user.user_link&&(e.canDelite=e.canEdit=!0),e.owner_info.avatar_url?e.owner_info.avatar_url=s.imgUrlConvert(e.owner_info.avatar_url):e.owner_info.avatar_url=d.avatarDefault,e.community_info.avatar_url?e.community_info.avatar_url=s.imgUrlConvert(e.community_info.avatar_url):e.community_info.avatar_url=n,e.comments||(e.comments_count=0),e.creation_date){const t=new Date(e.creation_date);e.raw_creation_date=e.creation_date.replace("+","%2B"),e.creation_date=new Date(t).toLocaleDateString("ru-RU",{dateStyle:"long"})}if(e.avatar_url=N.user.avatar_url,e.attachments)for(let i=0;i<e.attachments.length;i++){const a=e.attachments[i];let r=t._getSearch(a).type;"img"!==r&&(r="file"),e.attachments[i]={url:s.imgUrlConvert(a),id:i+1,type:r},t._getSearch(a).filename&&(e.attachments[i].filename=t._getSearch(a).filename)}}))):this.hasMorePosts=!1,r?this.posts.push(...e.body.posts):this.posts=e.body.posts}else 401===o.status?E.signOut():alert("getPostsByCommunity error");this._refreshStore()}async _createPost(e){e.attachments=[],this.deleteAttachments=[],this.addAttachments=[],this.attachments.forEach((t=>{"file"===t.type?e.attachments.push(s.imgUrlBackConvert(t.url)+`&filename=${t.filename}`):e.attachments.push(s.imgUrlBackConvert(t.url))})),this.attachments=[];const i=await s.createPost(e);if(200===i.status){const e=(await i.json()).body.posts[0];if(e.owner_info&&(e.canDelite=e.canEdit=!1,e.author_link===N.user.user_link?e.canDelite=e.canEdit=!0:e.owner_info.user_link===N.user.user_link&&(e.canDelite=!0),e.owner_info.avatar_url?e.owner_info.avatar_url=s.imgUrlConvert(e.owner_info.avatar_url):e.owner_info.avatar_url=d.avatarDefault),e.community_info&&(e.canDelite=e.canEdit=!1,I.curGroup.management.link===N.user.user_link&&(e.canDelite=e.canEdit=!0),e.community_info.avatar_url?e.community_info.avatar_url=s.imgUrlConvert(e.community_info.avatar_url):e.community_info.avatar_url=n),e.comments||(e.comments_count=0),e.creation_date&&(e.creation_date=B.fromBackToPost(e.creation_date)),e.avatar_url=N.user.avatar_url,e.attachments)for(let i=0;i<e.attachments.length;i++){const a=e.attachments[i];let r=t._getSearch(a).type;"img"!==r&&(r="file"),e.attachments[i]={url:s.imgUrlConvert(a),id:i+1,type:r},t._getSearch(a).filename&&(e.attachments[i].filename=t._getSearch(a).filename)}this.posts.unshift(e)}else 401===i.status?E.signOut():alert("createPost error");this._refreshStore()}async _deletePost(t){const e=await s.deletePost(t);if(200===e.status){let e=-1;for(let s=0;s<this.posts.length;s++)if(this.posts[s].id===t){e=s;break}e>-1&&this.posts.splice(e,1)}else 401===e.status?E.signOut():alert("deletePost error");this._refreshStore()}async _editPost(t,e){const i=await s.editPost(t,this.deleteAttachments,this.addAttachments,e);if(w.addAttachments=[],w.deleteAttachments=[],200===i.status){let s=-1;for(let t=0;t<this.posts.length;t++)if(this.posts[t].id===Number(e)){s=t;break}s>-1&&(this.posts[s].text_content=t,this.posts[s].attachments=this.attachments),this.attachments=[]}else 401===i.status?E.signOut():alert("editPost error");this._refreshStore()}async _likePost(t){const e=await s.likePost(t);if(200===e.status){const s=await e.json();this.posts.forEach((e=>{e.id===Number(t)&&(e.is_liked=!0,e.likes_amount=s.body.likes_amount)}))}else 401===e.status?E.signOut():alert("likePost error");this._refreshStore()}async _dislikePost(t){const e=await s.dislikePost(t);let i=null;200===e.status?this.posts.forEach((e=>{e.id===Number(t)&&(null===i&&(i=e.likes_amount-1),e.is_liked=!1,e.likes_amount=i)})):401===e.status?E.signOut():alert("dislikePost error"),this._refreshStore()}}var C=new w;const S={getChats(t,s){e.dispatch({actionName:"getChats",count:t,lastPostDate:s})},getChatsMsg(t,s,i,a,r=!1){e.dispatch({actionName:"getChatsMsg",callback:t,chatId:s,count:i,lastPostDate:a,isScroll:r})},chatCheck(t,s){e.dispatch({actionName:"chatCheck",userLink:t,callback:s})},msgSend(t,s,i,a=null){e.dispatch({actionName:"msgSend",chatId:t,text:s,attachments:a,stickerId:i})},chatCreate(t,s){e.dispatch({actionName:"chatCreate",userLinks:t,callback:s})},notifiesCount(t){e.dispatch({actionName:"notifiesCount",callback:t})},msgRead(t,s){e.dispatch({actionName:"msgRead",chat_id:t,time:s})}};var x=new class{constructor(){}getNotifiesCount(t=!1){const e=document.getElementById("js-msg-notifies");S.notifiesCount((s=>{e&&(e.textContent=s||""),t&&j._refreshStore()}))}};var j=new class{constructor(){this._callbacks=[],this.messages=[],this.chats=[],this.hasNextMessages=!0,e.register(this._fromDispatch.bind(this))}registerCallback(t){this._callbacks.push(t)}_refreshStore(){this._callbacks.forEach((t=>{t&&t()}))}async _fromDispatch(t){switch(t.actionName){case"getChats":await this._getChats(t.count,t.lastPostDate);break;case"getChatsMsg":await this._getChatsMsg(t.callback,t.chatId,t.count,t.lastPostDate,t.isScroll);break;case"chatCheck":await this._chatCheck(t.userLink,t.callback);break;case"msgSend":await this._msgSend(t.chatId,t.text,t.stickerId,t.attachments);break;case"chatCreate":await this._chatCreate(t.userLinks,t.callback);break;case"notifiesCount":await this._notifiesCount(t.callback);break;case"msgRead":await this._msgRead(t.chat_id,t.time);break;default:return}}async _getChats(t,e){const i=await s.getChats(t,e);if(200===i.status){const t=await i.json();this.chats=t.body.chats,this.chats.forEach((t=>{t.last_msg.creation_date&&(t.last_msg.creation_date=B.fromBackToPost(t.last_msg.creation_date)),1===t.members.length?(t.members[0].avatar_url?t.members[0].avatar_url=s.imgUrlConvert(t.members[0].avatar_url):t.members[0].avatar_url=d.avatarDefault,t.avatar_url=t.members[0].avatar_url,t.first_name=t.members[0].first_name,t.last_name=t.members[0].last_name):t.members.forEach((e=>{e.avatar_url?e.avatar_url=s.imgUrlConvert(e.avatar_url):e.avatar_url=d.avatarDefault,e.user_link!==N.user.user_link&&(t.avatar_url=e.avatar_url,t.first_name=e.first_name,t.last_name=e.last_name)}))}))}else 401===i.status?E.signOut():alert("getChats error");this._refreshStore()}async _getChatsMsg(e,i,a,r,n=!0){const o=await s.getChatsMsg(i,a,r);if(200===o.status){const i=await o.json();i.body.messages&&0!==i.body.messages.length?i.body.messages.forEach((e=>{if(e.sender_info.avatar_url?e.sender_info.avatar_url=s.imgUrlConvert(e.sender_info.avatar_url):e.sender_info.avatar_url=d.avatarDefault,e.sticker&&(e.sticker.url=s.stickerUrlConvert(e.sticker.url)),e.raw_creation_date=e.creation_date,e.creation_date_read=e.creation_date,e.creation_date=B.fromBackToMsg(e.creation_date),e.attachments)for(let i=0;i<e.attachments.length;i++){const a=e.attachments[i];let r=t._getSearch(a).type;"img"!==r&&(r="file"),e.attachments[i]={url:s.imgUrlConvert(a),id:i+1,type:r},t._getSearch(a).filename&&(e.attachments[i].filename=t._getSearch(a).filename)}})):this.hasNextMessages=!1,this.hasNextMessages=i.body.has_next,this.messages=n?i.body.messages.concat(this.messages):i.body.messages,e&&e()}else 401===o.status?E.signOut():alert("getChatsMsg error");this._refreshStore()}async _chatCheck(t,e){const i=await s.chatCheck(t);if(200===i.status){const t=await i.json();t.body.has_dialog?localStorage.setItem("chatFriendId",t.body.chat_id):localStorage.removeItem("chatFriendId")}else 401===i.status?E.signOut():alert("chatCheck error");e&&e()}async _msgSend(t,e,i,a){const r=await s.msgSend(t,e,i,a);401===r.status?E.signOut():200!==r.status&&alert("msgSend error"),this._refreshStore()}async _chatCreate(t,e){const i=await s.chatCreate(t);if(200===i.status){const t=await i.json();localStorage.setItem("chatId",t.body.chat.chat_id)}else 401===i.status?E.signOut():alert("chatCreate error");e&&e()}async _notifiesCount(t){const e=await s.notifiesCount();if(200===e.status){const s=await e.json();s.body.count?l.menuItemList[2].notifies=s.body.count:l.menuItemList[2].notifies="",t&&t(s.body.count)}else 401===e.status?E.signOut():alert("notifiesCount error")}async _msgRead(t,e){const i=await s.msgRead(t,e);200===i.status?x.getNotifiesCount(!0):401===i.status?E.signOut():alert("imgRead error")}};var L=new class{constructor(){"local"===s.beckendStatus?this._url="ws://"+s.backendHostname+":"+s.backendPort+"/api/ws":this._url="wss://"+s.backendHostname+"/api/ws",this._socket=null}open(){if(!window.WebSocket)throw new Error("Ошибка: браузер не поддерживает WebSocket");!this._socket&&N.user.isAuth&&navigator.onLine&&(this._socket=new WebSocket(this._url)),this._socket.onmessage=function(e){const i=JSON.parse(e.data);if(localStorage.getItem("chatId")===String(i.chat_id)&&"chat"===t.currentPage._jsId){if(S.msgRead(localStorage.getItem("chatId"),i.creation_date),i.creation_date=B.fromBackToMsg(i.creation_date),i.sender_info.avatar_url?i.sender_info.avatar_url=s.imgUrlConvert(i.sender_info.avatar_url):i.sender_info.avatar_url=d.avatarDefault,i.sticker&&(i.sticker.url=s.stickerUrlConvert(i.sticker.url)),i.attachments)for(let e=0;e<i.attachments.length;e++){const a=i.attachments[e];let r=t._getSearch(a).type;"img"!==r&&(r="file"),i.attachments[e]={url:s.imgUrlConvert(a),id:e+1,type:r},t._getSearch(a).filename&&(i.attachments[e].filename=t._getSearch(a).filename)}j.messages.push(i),document.getElementById("js-msg-input")&&localStorage.setItem("curMsg",document.getElementById("js-msg-input").value),j._refreshStore()}else{if("true"===localStorage.getItem("or-off")){new Audio("static/img/msg_fly.mp3").play()}x.getNotifiesCount(),S.getChats(100)}},this._socket.onclose=t=>{this._socket=null,this.open()}}close(){this._socket.close(1e3,"ok")}};var N=new class{constructor(){this._callbacks=[],this.user={isAuth:!1,errorAuth:"",errorReg:"",email:null,user_link:null,firstName:null,lastName:null,avatar_url:null,avg_avatar_color:null,bio:null,birthday:null,status:null,lastActive:null},this.userProfile={isAuth:!1,errorAuth:"",errorReg:"",email:null,user_link:null,firstName:null,lastName:null,avatar_url:null,avg_avatar_color:null,bio:null,birthday:null,status:null,lastActive:null},this.editMsg="",this.editStatus=null,this.profile=null,this.fields=null,e.register(this._fromDispatch.bind(this))}registerCallback(t){this._callbacks.push(t)}_refreshStore(){this._callbacks.forEach((t=>{t&&t()}))}async _fromDispatch(t){switch(t.actionName){case"signIn":await this._signIn(t.data);break;case"signUp":await this._signUp(t.data);break;case"signOut":await this._signOut();break;case"getProfile":await this._getProfile(t.callback,t.link);break;case"checkAuth":await this._checkAuth(t.callback);break;case"editProfile":await this._editProfile(t.data);break;default:return}}async _signIn(t){const e=await s.signIn(t.email,t.password);if(200===e.status){const t=e.headers.get("X-Csrf-Token");t&&localStorage.setItem("X-Csrf-Token",t),this.user.isAuth=!0,this.fields=null,L.open()}else this.user.errorAuth="Неверный email или пароль.",this.user.isAuth=!1,this.fields={email:t.email,password:t.password};this._refreshStore()}async _signUp(t){const e=await s.signUp(t.firstName,t.lastName,t.email,t.password,t.password2);if(200===e.status){const t=e.headers.get("X-Csrf-Token");t&&localStorage.setItem("X-Csrf-Token",t),this.user.isAuth=!0,this.fields=null,L.open()}else{const s=await e.json();this.user.errorReg=s.message,this.user.isAuth=!1,this.fields={firstName:t.firstName,lastName:t.lastName,email:t.email,password1:t.password,password2:t.password2}}this._refreshStore()}async _signOut(){await s.signOut(),this.user.isAuth=!1,this.editMsg="",this.editStatus=null,I.editMsg="",I.editStatus=null,localStorage.getItem("X-Csrf-Token")&&localStorage.removeItem("X-Csrf-Token"),this._refreshStore()}async _getProfile(e,i){const a=await s.getProfile(i),r=await a.json();if(200===a.status){let t={};t.avatar_url=r.body.profile.avatar_url,t.avg_avatar_color=r.body.profile.avg_avatar_color,t.user_link=r.body.profile.user_link,t.firstName=r.body.profile.first_name,t.lastName=r.body.profile.last_name,t.bio=r.body.profile.bio,t.status=r.body.profile.status,t.email=r.body.profile.email,r.body.profile.last_active&&("now"===r.body.profile.last_active?t.lastActive="онлайн":t.lastActive="был в сети: "+B.fromBackToPost(r.body.profile.last_active)),r.body.profile.birthday&&(t.birthday=r.body.profile.birthday),t.status||(t.status="статус не задан"),t.avatar_url?t.avatar_url=s.imgUrlConvert(t.avatar_url):t.avatar_url=d.avatarDefault,i&&i!==this.user.user_link?this.userProfile=t:(t.isAuth=!0,this.user=t)}else 401===a.status?E.signOut():404===a.status?t.go("/404"):alert("error getUserInfo");e&&e(),this._refreshStore()}async _checkAuth(t){const e=await s.checkAuth();if(200===e.status){const t=e.headers.get("X-Csrf-Token");t&&localStorage.setItem("X-Csrf-Token",t),this.user.isAuth=!0,L.open()}else this.user.isAuth=!1;t&&t(),this._refreshStore()}async _editProfile(t){const e=await s.editProfile(t.avatar_url,t.firstName,t.lastName,t.bio,t.birthday,t.status);200===e.status?(t.avatar_url&&(this.user.avatar_url=s.imgUrlConvert(t.avatar_url)),this.user.firstName=t.firstName,this.user.lastName=t.lastName,this.user.bio=t.bio,this.user.birthday=t.birthday,this.user.status=t.status,this.editMsg="Данные профиля успешно обновлены",this.editStatus=!0):401===e.status?E.signOut():(this.editMsg="Ошибка сервера",this.editStatus=!1),this._refreshStore()}};var F=new class{constructor(){this.validateFunc={password:this._validatePasswordAuth,email:this._validateEmail,firstName:this._validateName,lastName:this._validateSurname,secondPassword:this._validateTwoPasswords,userStatus:this._validateStatus,bio:this._validateBio,title:this._validateTitle,birthday:this._validateBirthday}}validation(t,e,s,i){const a=this.validateFunc[s](t.value);return!1===a.status?(e.textContent=a.error,"default"===i?(t.classList.remove("input-block__field-correct"),t.classList.add("input-block__field-incorrect")):(t.classList.remove("input-block-settings__field-correct"),t.classList.add("input-block-settings__field-incorrect")),!1):(e.textContent="","default"===i?(t.classList.add("input-block__field-correct"),t.classList.remove("input-block__field-incorrect")):(t.classList.add("input-block-settings__field-correct"),t.classList.remove("input-block-settings__field-incorrect")),!0)}validationPassword(t,e,s,i){const a=this._validateTwoPasswords(t.value,e.value);return!1===a.status?(s.textContent=a.error,"default"===i?(e.classList.remove("input-block__field-correct"),e.classList.add("input-block__field-incorrect")):(e.classList.remove("input-block-settings__field-correct"),e.classList.add("input-block-settings__field-incorrect")),!1):(s.textContent="","default"===i?(e.classList.add("input-block__field-correct"),e.classList.remove("input-block__field-incorrect")):(e.classList.add("input-block-settings__field-correct"),e.classList.remove("input-block-settings__field-incorrect")),!0)}_validatePasswordAuth(t){if(t.length<8)return{status:!1,error:"Пароль должен быть длиннее 8 символов"};t.trim();for(const e of t)if(" "===e)return{status:!1,error:"Пробелы в пароле недопустимы"};return{status:!0}}_validatePassword(t){if(!(t instanceof String)&&"string"!=typeof t)return{status:!1,error:"Недопустимый формат данных"};if(0===t.length)return{status:!1,error:"Введите пароль"};if(t.length<8)return{status:!1,error:"Пароль должен быть длиннее 8 символов"};if(t.length>100)return{status:!1,error:"Пароль должен быть короче 100 символов"};let e=!1,s=!1;for(const i of t)if(null!=i.match(/[a-zA-Z]/i)&&i===i.toUpperCase()&&(e=!0),null!=i.match(/^[0-9]+$/)&&(s=!0)," "===i)return{status:!1,error:"Пробелы в пароле не допускаются"};return s?e?{status:!0}:{status:!1,error:"Пароль должен содержать хотя бы одну заглавную букву"}:{status:!1,error:"Пароль должен содержать хотя бы одну цифру"}}_validateEmail(t){if(0===t.length)return{status:!1,error:"Введите электронную почту"};if(!(t instanceof String)&&"string"!=typeof t)return{status:!1,error:"Недопустимый формат данных"};return null==t.match(/@/)?{status:!1,error:"Некорректный адрес электронной почты"}:{status:!0}}_validateName(t){if(!(t instanceof String)&&"string"!=typeof t)return{status:!1,error:"Недопустимый формат данных"};if(0===t.length)return{status:!1,error:"Введите имя"};if(t.length>30)return{status:!1,error:"Имя должно быть короче 30 символов"};for(const e of t)if(null==e.match(/[a-zA-Zа-яА-ЯЁё]/i))return{status:!1,error:"Имя должно содержать буквенные символы"};return{status:!0}}_validateSurname(t){if(!(t instanceof String)&&"string"!=typeof t)return{status:!1,error:"Недопустимый формат данных"};if(0===t.length)return{status:!1,error:"Введите фамилию"};if(t.length>30)return{status:!1,error:"Фамилия должна быть короче 30 символов"};for(const e of t)if(null==e.match(/[a-zA-Zа-яА-Я]/i))return{status:!1,error:"Фамилия должна содержать буквенные символы"};return{status:!0}}_validateStatus(t){return t instanceof String||"string"==typeof t?0===t.length?{status:!1,error:"Введите статус"}:t.length>30?{status:!1,error:"Статус должен быть короче 30 символов"}:{status:!0}:{status:!1,error:"Недопустимый формат данных"}}_validateTitle(t){return t instanceof String||"string"==typeof t?0===t.length?{status:!1,error:"Введите название"}:t.length>30?{status:!1,error:"Название должно быть короче 30 символов"}:{status:!0}:{status:!1,error:"Недопустимый формат данных"}}_validateBio(t){return t instanceof String||"string"==typeof t?t.length>200?{status:!1,error:"Информация должна быть короче 200 символов"}:{status:!0}:{status:!1,error:"Недопустимый формат данных"}}_validateBirthday(t){return t>r?{status:!1,error:`Год рождения не должен превышать ${r.slice(0,4)}`}:{status:!0}}_validateTwoPasswords(t,e){return 0===e.length?{status:!1,error:"Введите пароль"}:t!==e?{status:!1,error:"Пароли не совпадают"}:{status:!0}}};const T={getPostsByUser(t,s,i,a){e.dispatch({actionName:"getPosts",userLink:t,count:s,lastPostDate:i,isScroll:a})},getFeedPosts(t,s,i){e.dispatch({actionName:"getFeedPosts",count:t,lastPostDate:s,isScroll:i})},getPostsById(t,s,i){e.dispatch({actionName:"getPostById",id:t,count:s,lastPostDate:i})},getPostsByCommunity(t,s,i,a){e.dispatch({actionName:"getPostsByCommunity",community_link:t,count:s,lastPostDate:i,isScroll:a})},deletePost(t){e.dispatch({actionName:"deletePost",postId:t})},createPostUser(t,s,i,a){e.dispatch({actionName:"createPost",data:{author_link:t,owner_link:s,show_author:i,text:a}})},createPostCommunity(t,s,i,a){e.dispatch({actionName:"createPost",data:{author_link:t,community_link:s,show_author:i,text:a}})},editPost(t,s){e.dispatch({actionName:"editPost",text:t,postId:s})},likePost(t){e.dispatch({actionName:"likePost",postId:t})},dislikePost(t){e.dispatch({actionName:"dislikePost",postId:t})},getComments(t,s,i){e.dispatch({actionName:"getComments",postID:t,count:s,lastCommentDate:i})},getComment(t){e.dispatch({actionName:"getComment",id:t})},createComment(t,s,i){e.dispatch({actionName:"createComment",postID:t,text:s,replyTo:i})},deleteComment(t){e.dispatch({actionName:"deleteComment",id:t})},editComment(t,s){e.dispatch({actionName:"editComment",id:t,text:s})}},D={search(t,s=3,i=0,a=!1){e.dispatch({actionName:"userSearch",searchText:t,count:s,offset:i,isScroll:a})},searchForDropdown(t){e.dispatch({actionName:"userSearch",searchText:t,count:3,offset:0})},friendSearchForDropdown(t){e.dispatch({actionName:"friendsSearch",link:t,count:3,offset:0})}};var G=new class{constructor(){this._callbacks=[],this.userSearchItems=[],this.communitySearchItems=[],this.hasNextUsers=!0,this.hasNextGroups=!0,e.register(this._fromDispatch.bind(this))}registerCallback(t){this._callbacks.push(t)}_refreshStore(){this._callbacks.forEach((t=>{t&&t()}))}async _fromDispatch(t){"userSearch"===t.actionName&&await this._getGlobalSearchResult(t.searchText,t.count,t.offset,t.isScroll)}async _getGlobalSearchResult(t,e,i,a=!1){const r=await s.getGlobalSearchResult(t,e,i);if(200===r.status){const t=await r.json();t.body.users&&0!==t.body.users.length?(this.hasNextUsers=!0,t.body.users.forEach((t=>{t.avatar_url||(t.avatar_url=d.avatarDefault),t.isFriend||t.isSubscriber||t.isSubscribed||(t.isUser=!0)}))):this.hasNextUsers=!1,a?this.userSearchItems.push(...t.body.users):this.userSearchItems=t.body.users,t.body.communitites&&0!==t.body.communitites.length?(this.hasNextGroups=!0,t.body.communitites.forEach((t=>{t.avatar_url||(t.avatar_url=d.avatarDefault),t.isCommunity=!0}))):this.hasNextGroups=!1,a?this.communitySearchItems.push(...t.body.communitites):this.communitySearchItems=t.body.communitites}else 401===r.status?E.signOut():400===r.status?(this.userSearchItems=[],this.communitySearchItems=[]):alert("search error");this._refreshStore()}};var A=new class{constructor(){this._callbacks=[],this.friends=[],e.register(this._fromDispatch.bind(this))}registerCallback(t){this._callbacks.push(t)}_refreshStore(){this._callbacks.forEach((t=>{t&&t()}))}async _fromDispatch(t){"friendsSearch"===t.actionName&&await this._getFriends(t.link,t.count,t.offset)}async _getFriends(t,e,i){const a=await s.getFriends(t,e,i),r=await a.json();200===a.status?(r.body.friends.forEach((t=>{t.isFriend=!0,t.avatar_url?t.avatar_url=s.imgUrlConvert(t.avatar_url):t.avatar_url=d.avatarDefault,t.city||(t.city="город не указан")})),this.friends=r.body.friends):401===a.status?E.signOut():alert("error"),this._refreshStore()}};const H={getFriends(t,s,i,a=!1){e.dispatch({actionName:"getFriends",link:t,count:s,offset:i,isScroll:a})},isFriend(t){e.dispatch({actionName:"isFriend",link:t})},getUsers(t,s,i=!1){e.dispatch({actionName:"getUsers",count:t,offset:s,isScroll:i})},getNotFriends(t,s,i=!1){e.dispatch({actionName:"getNotFriends",count:t,offset:s,isScroll:i})},getSubscriptions(t,s,i,a=!1){e.dispatch({actionName:"getSub",type:"out",link:t,count:s,offset:i,isScroll:a})},getSubscribers(t,s,i,a=!1){e.dispatch({actionName:"getSub",type:"in",link:t,count:s,offset:i,isScroll:a})},sub(t){e.dispatch({actionName:"sub",link:t})},unsub(t){e.dispatch({actionName:"unsub",link:t})},reject(t){e.dispatch({actionName:"reject",link:t})}};var U=new class{constructor(){this._callbacks=[],this.friends=[],this.notFriends=[],this.users=[],this.subscribers=[],this.subscriptions=[],this.isMyFriend="none",this.hasMoreFriends=!0,this.hasMoreSubscribers=!0,this.hasMoreSubscriptions=!0,this.hasMoreUsers=!0,e.register(this._fromDispatch.bind(this))}registerCallback(t){this._callbacks.push(t)}_refreshStore(){this._callbacks.forEach((t=>{t&&t()}))}async _fromDispatch(t){switch(t.actionName){case"getFriends":await this._getFriends(t.link,t.count,t.offset,t.isScroll);break;case"isFriend":await this._isFriend(t.link);break;case"getNotFriends":await this._getNotFriends(t.link,t.count,t.offset,t.isScroll);break;case"getUsers":await this._getUsers(t.count,t.offset,t.isScroll);break;case"getSub":await this._getSub(t.type,t.link,t.count,t.offset,t.isScroll);break;case"sub":await this._sub(t.link);break;case"unsub":await this._unsub(t.link);break;case"reject":await this._reject(t.link);break;default:return}}async _getFriends(t,e,i,a=!1){const r=await s.getFriends(t,e,i),n=await r.json();200===r.status?(n.body.friends&&0!==n.body.friends.length?(this.hasMoreFriends=!0,n.body.friends.forEach((t=>{t.isFriend=!0,t.avatar_url?t.avatar_url=s.imgUrlConvert(t.avatar_url):t.avatar_url=d.avatarDefault,t.city||(t.city="город не указан")}))):this.hasMoreFriends=!1,a?this.friends.push(...n.body.friends):this.friends=n.body.friends):401===r.status?E.signOut():alert("error"),this._refreshStore()}async _isFriend(t){const e=await s.isFriend(t);if(this.isMyFriend="none",200===e.status){const t=await e.json();this.isMyFriend=t.body.status}else 401===e.status?E.signOut():alert("isFriend error");this._refreshStore()}async _getNotFriends(t,e,i,a=!1){const r=await s.getNotFriends(t,e,i),n=await r.json();200===r.status?(n.body.profiles&&0!==n.body.profiles.length?(this.hasMoreUsers=!0,n.body.profiles.forEach((t=>{t.isUser=!0,t.avatar_url?t.avatar_url=s.imgUrlConvert(t.avatar_url):t.avatar_url=d.avatarDefault,t.city||(t.city="город не указан")}))):this.hasMoreUsers=!1,a?this.notFriends.push(...n.body.profiles):this.notFriends=n.body.profiles):401===r.status?E.signOut():alert("error"),this._refreshStore()}async _getUsers(t,e,i=!1){const a=await s.getUsers(t,e),r=await a.json();200===a.status?(r.body.profiles&&0!==r.body.profiles.length?(this.hasMoreItems=!0,r.body.profiles.forEach((t=>{t.avatar_url?t.avatar_url=s.imgUrlConvert(t.avatar_url):t.avatar_url=d.avatarDefault,t.city||(t.city="город не указан")}))):this.hasMoreItems=!1,i?this.users.push(...r.body.profiles):this.users=r.body.profiles):401===a.status?E.signOut():alert("error"),this._refreshStore()}async _getSub(t,e,i,a,r=!1){const n=await s.getSub(t,e,i,a),o=await n.json();200===n.status?"in"===t?(o.body.subs&&0!==o.body.subs.length?(this.hasMoreSubscribers=!0,o.body.subs.forEach((t=>{t.avatar_url?t.avatar_url=s.imgUrlConvert(t.avatar_url):t.avatar_url=d.avatarDefault,t.isSubscriber=!0}))):this.hasMoreSubscribers=!1,r?this.subscribers.push(...o.body.subs):this.subscribers=o.body.subs):(o.body.subs&&0!==o.body.subs.length?(this.hasMoreSubscriptions=!0,o.body.subs.forEach((t=>{t.avatar_url?t.avatar_url=s.imgUrlConvert(t.avatar_url):t.avatar_url=d.avatarDefault,t.isSubscribed=!0}))):this.hasMoreSubscriptions=!1,r?this.subscriptions.push(...o.body.subs):this.subscriptions=o.body.subs):401===n.status?E.signOut():alert("error"),this._refreshStore()}async _sub(t){const e=await s.sub(t);200===e.status?("none"===this.isMyFriend?this.isMyFriend="subscriber":"subscribed"===this.isMyFriend&&(this.isMyFriend="friend"),H.getFriends(N.user.user_link,15,0),H.getNotFriends(15,0),H.getSubscribers(N.user.user_link,15),H.getSubscriptions(N.user.user_link,15)):401===e.status?E.signOut():alert("error"),this._refreshStore()}async _unsub(t){const e=await s.unsub(t);200===e.status?("subscriber"===this.isMyFriend?this.isMyFriend="none":"friend"===this.isMyFriend&&(this.isMyFriend="subscribed"),H.getFriends(N.user.user_link,15,0),H.getNotFriends(15,0),H.getSubscribers(N.user.user_link,15),H.getSubscriptions(N.user.user_link,15)):401===e.status?E.signOut():alert("error"),this._refreshStore()}async _reject(t){const e=await s.reject(t);200===e.status||(401===e.status?E.signOut():alert("error")),this._refreshStore()}};class M{constructor(){this.addHandlebarsPartial(),this.addStore(),this.curPage=!1,this.timerId=null}addStore(){G.registerCallback(this._updateDropdownSearchList.bind(this)),A.registerCallback(this._initDropdownSearchList.bind(this))}addHandlebarsPartial(){Handlebars.registerPartial("button",Handlebars.templates.button),Handlebars.registerPartial("buttonDefault",Handlebars.templates.buttonDefault),Handlebars.registerPartial("chat",Handlebars.templates.chat),Handlebars.registerPartial("chatItem",Handlebars.templates.chatItem),Handlebars.registerPartial("chatPage",Handlebars.templates.chatPage),Handlebars.registerPartial("comment",Handlebars.templates.comment),Handlebars.registerPartial("commentArea",Handlebars.templates.commentArea),Handlebars.registerPartial("createPost",Handlebars.templates.createPost),Handlebars.registerPartial("editPost",Handlebars.templates.editPost),Handlebars.registerPartial("editPostPage",Handlebars.templates.editPostPage),Handlebars.registerPartial("feed",Handlebars.templates.feed),Handlebars.registerPartial("friend",Handlebars.templates.friend),Handlebars.registerPartial("friendNotFound",Handlebars.templates.friendNotFound),Handlebars.registerPartial("friends",Handlebars.templates.friends),Handlebars.registerPartial("groupItem",Handlebars.templates.groupItem),Handlebars.registerPartial("subscriber",Handlebars.templates.subscriber),Handlebars.registerPartial("newGroup",Handlebars.templates.newGroup),Handlebars.registerPartial("deleteGroup",Handlebars.templates.deleteGroup),Handlebars.registerPartial("groups",Handlebars.templates.groups),Handlebars.registerPartial("group",Handlebars.templates.group),Handlebars.registerPartial("groupCard",Handlebars.templates.groupCard),Handlebars.registerPartial("header",Handlebars.templates.header),Handlebars.registerPartial("inputField",Handlebars.templates.inputField),Handlebars.registerPartial("inputSettings",Handlebars.templates.inputSettings),Handlebars.registerPartial("logoPath",Handlebars.templates.logoPath),Handlebars.registerPartial("menuItem",Handlebars.templates.menuItem),Handlebars.registerPartial("message",Handlebars.templates.message),Handlebars.registerPartial("messages",Handlebars.templates.messages),Handlebars.registerPartial("post",Handlebars.templates.post),Handlebars.registerPartial("postArea",Handlebars.templates.postArea),Handlebars.registerPartial("profile",Handlebars.templates.profile),Handlebars.registerPartial("profileCard",Handlebars.templates.profileCard),Handlebars.registerPartial("search",Handlebars.templates.search),Handlebars.registerPartial("settings",Handlebars.templates.settings),Handlebars.registerPartial("settingsPath",Handlebars.templates.settingsPath),Handlebars.registerPartial("settingsPathGroup",Handlebars.templates.settingsPathGroup),Handlebars.registerPartial("sideBar",Handlebars.templates.sideBar),Handlebars.registerPartial("signIn",Handlebars.templates.signIn),Handlebars.registerPartial("signUp",Handlebars.templates.signUp),Handlebars.registerPartial("signInPath",Handlebars.templates.signInPath),Handlebars.registerPartial("signUpPath",Handlebars.templates.signUpPath),Handlebars.registerPartial("searchDropdown",Handlebars.templates.searchDropdown),Handlebars.registerPartial("searchItem",Handlebars.templates.searchItem),Handlebars.registerPartial("subscriber",Handlebars.templates.subscriber),Handlebars.registerPartial("smiles",Handlebars.templates.smiles),Handlebars.registerPartial("stickers",Handlebars.templates.stickers),Handlebars.registerHelper("combine",(function(t,e){return Object.assign({},t,e)})),Handlebars.registerHelper("eq",(function(t,e){return t===e.toString()})),Handlebars.registerHelper("eqs",(function(t,e,s){return t===e||t===s})),Handlebars.registerHelper("second-if-any",(function(t,e){return e||t})),Handlebars.registerHelper("num-subs",(function(t){return t%100>10&t%100<20?"подписчиков":t%10==1?"подписчик":t%10==2||t%10==3||t%10==4?"подписчика":"подписчиков"}))}addPagesElements(){this._exitBtn=document.getElementById("js-exit-btn"),this._settingsBtn=document.getElementById("js-settings-btn"),this._feedBtn=document.getElementById("js-logo-go-feed"),this._myPageItem=document.getElementById("js-side-bar-my-page"),this._myPageImg=document.getElementById("js-side-bar-my-page-img"),this._myPageImgActive=document.getElementById("js-side-bar-my-page-img-active"),this._newsItem=document.getElementById("js-side-bar-news"),this._newsImg=document.getElementById("js-side-bar-news-img"),this._newsImgActive=document.getElementById("js-side-bar-news-img-active"),this._msgItem=document.getElementById("js-side-bar-msg"),this._msgImg=document.getElementById("js-side-bar-msg-img"),this._msgImgActive=document.getElementById("js-side-bar-msg-img-active"),this._photoItem=document.getElementById("js-side-bar-photo"),this._photoImg=document.getElementById("js-side-bar-photo-img"),this._photoImgActive=document.getElementById("js-side-bar-photo-img-active"),this._friendsItem=document.getElementById("js-side-bar-friends"),this._friendsImg=document.getElementById("js-side-bar-friends-img"),this._friendsImgActive=document.getElementById("js-side-bar-friends-img-active"),this._groupsItem=document.getElementById("js-side-bar-groups"),this._groupsImg=document.getElementById("js-side-bar-groups-img"),this._groupsImgActive=document.getElementById("js-side-bar-groups-img-active"),this._bookmarksItem=document.getElementById("js-side-bar-bookmarks"),this._bookmarksImg=document.getElementById("js-side-bar-bookmarks-img"),this._bookmarksImgActive=document.getElementById("js-side-bar-bookmarks-img-active"),this._searchAreaInput=document.getElementById("js-search-area-input"),this._searchArea=document.getElementById("js-search-area"),this._searchDropdown=document.getElementById("js-search-dropdown"),this._showMorePeopleButton=document.getElementById("js-show-more-people"),this._showMoreCommunititesButton=document.getElementById("js-show-more-communities"),this._sendMessageButtons=document.getElementsByClassName("search-item__send-message-icon-container"),this._subscribeButtons=document.getElementsByClassName("search-item__subscription-icon-container"),this._goToProfile=document.getElementsByClassName("js-go-to-profile"),this._goToGroup=document.getElementsByClassName("js-go-to-group"),this._userSearchItems=document.getElementsByClassName("user-search-item"),this._group_search_items=document.getElementsByClassName("group-search-item"),this._headerAvatar=document.getElementById("js-header-avatar")}addPagesListener(){this._exitBtn.addEventListener("click",(()=>{E.signOut()})),this._settingsBtn.addEventListener("click",(()=>{t.go("/settings",!1)})),this._groupsItem.addEventListener("click",(()=>{t.go("/groups",!1)})),this._feedBtn.addEventListener("click",(()=>{t.go("/feed",!1)})),this._myPageItem.addEventListener("click",(()=>{t.go("/user",!1)})),this._headerAvatar.addEventListener("click",(()=>{t.go("/user",!1)})),this._msgItem.addEventListener("click",(()=>{t.go("/message",!1)})),this._newsItem.addEventListener("click",(()=>{t.go("/feed",!1)})),this._friendsItem.addEventListener("click",(()=>{U._getFriends(N.user.user_link,1).then((()=>{U.friends.length?t.go("/friends",!1):t.go("/find-friends",!1)}))})),this._searchArea.addEventListener("blur",(t=>{this._searchDropdown.style.display="none"}),!0),this._searchAreaInput.addEventListener("keyup",(t=>{this.interruptTimer(),this.startTimer(250,(()=>{""===this._searchAreaInput.value.trim()&&this._initDropdownSearchList(),""!==this._searchAreaInput.value.trim()&&D.searchForDropdown(this._searchAreaInput.value)}))})),this._searchAreaInput.addEventListener("click",(()=>{this._searchDropdown.style.display="grid",""===this._searchAreaInput.value.trim()?null===N.user.user_link?E.getProfile((()=>{D.friendSearchForDropdown(N.user.user_link,3,0)})):D.friendSearchForDropdown(N.user.user_link,3,0):D.searchForDropdown(this._searchAreaInput.value)}));for(let e=0;e<this._goToProfile.length;e++)this._goToProfile[e].addEventListener("click",(()=>{const s=this._goToProfile[e].getAttribute("data-id");t.go("/user?link="+s,!1)}));for(let e=0;e<this._goToGroup.length;e++)this._goToGroup[e].addEventListener("click",(()=>{const s=this._goToGroup[e].getAttribute("data-id");t.go("/group?link="+s,!1)}))}_addDropdownEventListeners(){for(let t=0;t<this._sendMessageButtons.length;++t)this._sendMessageButtons[t].addEventListener("mousedown",(()=>{let e=this._userSearchItems[t].getAttribute("data-user-link");this.startMessaging(e)}));for(let t=0;t<this._subscribeButtons.length;++t)this._subscribeButtons[t].addEventListener("mousedown",(e=>{let s=this._group_search_items[t].getAttribute("data-group-link");this.subscribe(s),this._subscribeButtons[t].hidden=!0,e.stopImmediatePropagation()}));null!==this._showMorePeopleButton&&this._showMorePeopleButton.addEventListener("mousedown",(()=>{localStorage.setItem("searchQuery",this._searchAreaInput.value),t.go("/find-friends")})),null!==this._showMoreCommunititesButton&&this._showMoreCommunititesButton.addEventListener("mousedown",(()=>{localStorage.setItem("searchQuery",this._searchAreaInput.value),t.go("/find-groups")}));for(let e=0;e<this._group_search_items.length;e++)this._group_search_items[e].addEventListener("mousedown",(()=>{const s=this._group_search_items[e].getAttribute("data-group-link");t.go("/group?link="+s)}));for(let e=0;e<this._userSearchItems.length;e++)this._userSearchItems[e].addEventListener("mousedown",(()=>{const s=this._userSearchItems[e].getAttribute("data-user-link");t.go("/user?link="+s)}))}_updateDropdownSearchList(){this.addPagesElements(),this._template=Handlebars.templates.searchDropdown;let t=0===G.userSearchItems.length&&0===G.communitySearchItems.length;this._context={userSearchItems:G.userSearchItems,communitySearchItems:G.communitySearchItems,isEmpty:t,searchDropdownConst:f},this._searchDropdown.innerHTML=this._template(this._context),this.addPagesElements(),this._addDropdownEventListeners()}_initDropdownSearchList(){this.addPagesElements(),this._template=Handlebars.templates.searchDropdown;let t=0===A.friends.length;this._context={userSearchItems:A.friends,communitySearchItems:[],isEmpty:t,searchDropdownConst:f},this._searchDropdown.innerHTML=this._template(this._context),this.addPagesElements(),this._addDropdownEventListeners()}remove(){document.getElementById(this._jsId)?.remove()}updatePage(){this.curPage&&(N.user.isAuth?this.render():t.go("/sign-in"))}subscribe(t){P.groupSub(t)}startMessaging(e){S.chatCheck(e,(()=>{localStorage.getItem("chatFriendId")?(localStorage.setItem("chatId",localStorage.getItem("chatFriendId")),t.go("/chat",!1),S.getChatsMsg(null,localStorage.getItem("chatId"),15)):S.chatCreate(e,(()=>{localStorage.getItem("chatId")&&(t.go("/chat",!1),S.getChatsMsg(null,localStorage.getItem("chatId"),15))}))}))}startTimer(t,e){this.timerId=window.setTimeout(e,t)}interruptTimer(){window.clearTimeout(this.timerId)}_preRender(){}render(){this._preRender(),t.rootElement.innerHTML=this._template(this._context),this.addPagesElements(),this.addPagesListener()}}const q={uploadImg(t,s,i=null){e.dispatch({actionName:"uploadImg",data:t,callback:s,filename:i})},deleteImg(){e.dispatch({actionName:"deleteImg"})}};var O=new class{constructor(){this._callbacks=[],this.editError="",e.register(this._fromDispatch.bind(this))}registerCallback(t){this._callbacks.push(t)}_refreshStore(){this._callbacks.forEach((t=>{t&&t()}))}async _fromDispatch(t){"uploadImg"===t.actionName&&await this._uploadImg(t.data,t.callback,t.filename)}async _uploadImg(t,e,i){this.editError="";const a=await s.uploadImg(t,i),r=await a.json();if(200===a.status){e(`static-service/download?name=${r.body.form[0].name}&type=${r.body.form[0].type}`)}else 413===a.status?(this.editError="Файл слишком большой",this._refreshStore()):alert("uploadImg error")}};const $={getStickerPack(t){e.dispatch({actionName:"getStickerPack",packId:t})},getStickerPackInfo(t){e.dispatch({actionName:"getStickerPackInfo",packId:t})},getPopularStickerPacks(t,s){e.dispatch({actionName:"getPopularStickerPacks",count:t,offset:s})},getStickerPacksByAuthor(t,s,i){e.dispatch({actionName:"getStickerPacksByAuthor",count:t,offset:s,author:i})},uploadStickerPack(t,s){e.dispatch({actionName:"uploadStickerPack",data:t,callback:s})}};var R=new class{constructor(){this._callbacks=[],this.stickerPacks=[],this.stickerPack=null,e.register(this._fromDispatch.bind(this))}registerCallback(t){this._callbacks.push(t)}_refreshStore(){this._callbacks.forEach((t=>{t&&t()}))}async _fromDispatch(t){switch(t.actionName){case"getStickerPackInfo":await this._getStickerPackInfo(t.packId);break;case"getStickerPacksByAuthor":await this._getStickerPacksByAuthor(t.count,t.offset,t.author);break;default:return}}async _getStickerPackInfo(t){const e=await s.getStickerPackInfo(t),i=await e.json();200===e.status?this.stickerPack=i.body:alert("getStickerPackInfo error")}async _getStickerPacksByAuthor(t,e,i){const a=await s.getStickerPacksByAuthor(t,e,i),r=await a.json();200===a.status?(this.stickerPacks=r.body.stickerpacks,this.stickerPacks.forEach((t=>{t.stickers.forEach((t=>{t.url=s.stickerUrlConvert(t.url)}))}))):alert("getStickerPackInfo error")}};localStorage.getItem("or-off")||localStorage.setItem("or-off","true"),"serviceWorker"in navigator&&window.addEventListener("load",(()=>{navigator.serviceWorker.register("/service-worker.js").then((t=>{console.log("Service Worker registered:",t)})).catch((t=>{console.log("Service Worker registration failed:",t)}))}));const z={FeedView:new class extends M{constructor(){super(),this._jsId="feed",this.curPage=!1,this._commentBatchToLoad=5,this.isCreate=!1,this.isEdit=!1,this._postBatchSize=15}addStore(){j.registerCallback(this.updatePage.bind(this)),C.registerCallback(this.updatePage.bind(this)),N.registerCallback(this.updatePage.bind(this)),O.registerCallback(this.updatePage.bind(this))}addPagesElements(){super.addPagesElements(),this._newsItem.style.color=i,this._newsImg.style.display="none",this._newsImgActive.style.display="inline-block",this._feedPage=document.getElementById("feed"),this._deletePosts=document.getElementsByClassName("post-menu-item-delete"),this._likePosts=document.getElementsByClassName("post-buttons-like__icon"),this._dislikePosts=document.getElementsByClassName("post-buttons-dislike__icon"),this._createPosts=document.getElementById("js-create-post"),this._postsTexts=document.getElementsByClassName("post-text"),this._posts=document.getElementsByClassName("post"),this._commentsButtons=document.getElementsByClassName("post-buttons-comment"),this._commentsAreas=document.getElementsByClassName("comments-area"),this._sendCommentButtons=document.getElementsByClassName("create-comment__send-icon"),this._commentInput=document.getElementsByClassName("comment-input"),this._commentDeleteButton=document.getElementsByClassName("comment-operations__delete"),this._editPostError=document.getElementById("js-edit-post-error"),this._commentEditButton=document.getElementsByClassName("comment-operations__update"),this._commentEditSaveButton=document.getElementsByClassName("submit-comment-edit-button"),this._commentEditCancelButton=document.getElementsByClassName("cancel-comment-edit-button"),this._commentEditInput=document.getElementsByClassName("edit-comment__input"),this._showMoreCommentsButton=document.getElementsByClassName("show-more-block"),this._editPosts=document.getElementsByClassName("post-menu-item-edit"),this._editBtn=document.getElementById("js-edit-post-btn"),this._createBtn=document.getElementById("js-create-post-btn"),this._backBtn=document.getElementById("js-back-post-btn"),this._addPhotoToPostPic=document.getElementById("js-add-photo-to-post-pic"),this._addPhotoToPost=document.getElementById("js-add-photo-to-post"),this._addSmileToPost=document.getElementById("js-add-smile-to-post"),this._removeImg=document.getElementsByClassName("close-button"),this._emotionBtn=document.getElementById("js-post-smiles"),this._emotionKeyboard=document.getElementById("js-smiles-keyboard"),this._smiles=document.getElementsByClassName("js-smile"),this._emotionBtnComment=document.getElementsByClassName("comment-icon_smiles"),this._install=document.getElementsByClassName("js-file-i")}addPagesListener(){if(super.addPagesListener(),window.onscroll=()=>{scrollY+innerHeight>=document.body.scrollHeight&&!this.watingForNewPosts&&C.hasMorePosts&&(T.getFeedPosts(this._postBatchSize,C.posts.at(-1).raw_creation_date,!0),this.watingForNewPosts=!0)},this._text=document.getElementById("js-edit-post-textarea"),this._text){this._text.focus(),this._editBtn=document.getElementById("js-edit-post-btn");let t=document.getElementsByTagName("textarea");t[0].setAttribute("style","height:"+t[0].scrollHeight+"px;"),t[0].addEventListener("input",(function(){this.style.height="auto",this.style.height=this.scrollHeight+"px"}),!1)}for(let t=0;t<this._deletePosts.length;t++)this._deletePosts[t].addEventListener("click",(()=>{const e=this._deletePosts[t].getAttribute("data-id");T.deletePost(Number(e))}));for(let t=0;t<this._likePosts.length;t++)this._likePosts[t].addEventListener("click",(()=>{const e=this._likePosts[t].getAttribute("data-id");T.likePost(Number(e))}));for(let t=0;t<this._dislikePosts.length;t++)this._dislikePosts[t].addEventListener("click",(()=>{const e=this._dislikePosts[t].getAttribute("data-id");T.dislikePost(Number(e))}));for(let t=0;t<this._commentsButtons.length;t++)this._commentsButtons[t].addEventListener("click",(()=>{if(void 0===C.comments.get(C.posts[t].id)||0===C.comments.get(C.posts[t].id).length)T.getComments(C.posts[t].id,this._commentBatchToLoad);else{C.comments.delete(C.posts[t].id),this._posts[t].getElementsByClassName("comments-list")[0].style.display="none";let e=this._commentsAreas[t].getElementsByClassName("show-more-block");this._commentsAreas[t].removeChild(e[0]),C.haveCommentsContinuation.delete(C.posts[t].id)}}));for(let t=0;t<this._sendCommentButtons.length;++t)this._sendCommentButtons[t].addEventListener("click",(()=>{""!==this._commentInput[t].textContent.trim()&&T.createComment(C.posts[t].id,this._commentInput[t].textContent.trim(),null)}));for(let t=0;t<this._commentInput.length;++t)this._commentInput[t].addEventListener("keyup",(e=>{""===this._commentInput[t].textContent.trim()||"Enter"!==e.code||e.shiftKey||document.activeElement!==this._commentInput[t]||(console.log(this._commentInput[t].textContent),e.preventDefault(),T.createComment(C.posts[t].id,this._commentInput[t].textContent.trim(),null))}));for(let t=0;t<this._commentDeleteButton.length;++t)this._commentDeleteButton[t].addEventListener("click",(()=>{let e=this._commentDeleteButton[t].getAttribute("data-comment-id");T.deleteComment(e);let s=Number(this._commentDeleteButton[t].getAttribute("data-post-id")),i=C.comments.get(s);for(let t=0;t<i.length;++t)if(i[t].id===Number(e)){i.splice(t,1);break}C.comments.set(s,i);for(let t=0;t<C.posts.length;++t)C.posts[t].id===s&&C.posts[t].comments_amount--;this.updatePage()}));for(let t=0;t<this._commentEditButton.length;++t)this._commentEditButton[t].addEventListener("click",(()=>{let e=Number(this._commentDeleteButton[t].getAttribute("data-post-id")),s=C.comments.get(e),i=Number(this._commentDeleteButton[t].getAttribute("data-comment-id"));for(let t=0;t<s.length;++t)s[t].id===i&&(s[t].editing_mode=!0,s[t].cur_comment=s[t].text);this.updatePage()}));for(let t=0;t<this._commentEditSaveButton.length;++t)this._commentEditSaveButton[t].addEventListener("click",(()=>{let e=this._commentEditInput[t].textContent.trim();if(""!==this._commentEditInput[t].textContent.trim()){let s=Number(this._commentEditSaveButton[t].getAttribute("data-comment-id"));T.editComment(s,e);let i=Number(this._commentEditSaveButton[t].getAttribute("data-post-id")),a=C.comments.get(i);for(let t=0;t<a.length;++t)a[t].id===s&&(a[t].editing_mode=!1,a[t].text=e)}}));for(let t=0;t<this._commentEditCancelButton.length;++t)this._commentEditCancelButton[t].addEventListener("click",(()=>{let e=Number(this._commentEditSaveButton[t].getAttribute("data-comment-id")),s=Number(this._commentEditSaveButton[t].getAttribute("data-post-id")),i=C.comments.get(s);for(let t=0;t<i.length;++t)i[t].id===e&&(i[t].editing_mode=!1);this.updatePage()}));for(let t=0;t<this._showMoreCommentsButton.length;++t)this._showMoreCommentsButton[t].addEventListener("click",(()=>{let e=Number(this._showMoreCommentsButton[t].getAttribute("data-post-id")),s=C.comments.get(e).at(-1).raw_creation_date;for(let t=0;t<C.posts.length;++t)if(C.posts[t].id===e){T.getComments(e,this._commentBatchToLoad,s);break}}));for(let t=0;t<this._postsTexts.length;t++){const e=this._postsTexts[t].textContent;if(e.split("\n").length>3||e.length>a){const s=this._postsTexts[t];let i;if(e.length>a)i=e.slice(0,a)+"...";else{const t=e.indexOf("\n",e.indexOf("\n",e.indexOf("\n")+1)+1);i=e.slice(0,t)+"..."}s.textContent=i;const r=document.createElement("div");r.textContent="Показать еще",r.style.color="#9747FF",r.style.cursor="pointer",s.appendChild(r),r.addEventListener("click",(function(){s.textContent=e}))}}for(let t=0;t<this._editPosts.length;t++)this._editPosts[t].addEventListener("click",(()=>{this.isEdit=this._editPosts[t].getAttribute("data-id"),this.isCreate=!1,O.editError="",this._editPostError="",T.getPostsById(this.isEdit,1)}));this._createPosts&&this._createPosts.addEventListener("click",(()=>{this.isCreate=!0,this.isEdit=!1,O.editError="",this._editPostError="",super.render(),this._text.focus()})),this._addPhotoToPost&&this._addPhotoToPost.addEventListener("click",(()=>{this._createPosts.click(),this._addPhotoToPostPic.click()})),this._addSmileToPost&&this._addSmileToPost.addEventListener("click",(()=>{this._createPosts.click(),this._emotionBtn.click()})),this._editBtn&&this._editBtn.addEventListener("click",(()=>{T.editPost(this._text.value,this.isEdit),this.isEdit=!1})),this._createBtn&&this._createBtn.addEventListener("click",(()=>{""===this._text.value&&0===C.attachments.length?this._editPostError.textContent="Запись не может быть пустой":(this._editPostError.textContent="",T.createPostUser(N.user.user_link,N.user.user_link,!0,this._text.value),this.isCreate=!1)})),this._text&&this._text.addEventListener("input",(()=>{this._editPostError.textContent=""})),this._backBtn&&this._backBtn.addEventListener("click",(()=>{this.isCreate=this.isEdit=!1,C.attachments=[],O.editError="",super.render()})),this._addPhotoToPostPic&&this._addPhotoToPostPic.addEventListener("click",(()=>{if(null===C.attachments&&(C.attachments=[]),C.attachments.length>=10)return;C.text=this._text.value;const e=document.createElement("input");e.type="file",e.addEventListener("change",(function(e){const i=e.target.files[0],a=new FileReader;a.onload=function(e){q.uploadImg(i,(e=>{let a=1;C.attachments.length&&(a=C.attachments[C.attachments.length-1].id+1),"img"===t._getSearch(e).type?(C.attachments.push({url:s.imgUrlConvert(e),id:a,type:"img"}),C.addAttachments.push(e)):(C.attachments.push({url:s.imgUrlConvert(e),id:a,type:"file",filename:i.name}),C.addAttachments.push(e+`&filename=${i.name}`)),C._refreshStore()}))},a.readAsDataURL(i)})),e.click()}));for(let t=0;t<this._removeImg.length;t++)this._removeImg[t].addEventListener("click",(()=>{const e=this._removeImg[t].getAttribute("data-id");let i=-1;for(let t=0;t<C.attachments.length;t++)if(C.attachments[t].id.toString()===e){i=t,C.deleteAttachments.push(s.imgUrlBackConvert(C.attachments[t].url));break}i>-1&&C.attachments.splice(i,1),C.text=this._text.value,C._refreshStore()}));this._emotionBtn&&this._emotionBtn.addEventListener("click",(()=>{"block"===this._emotionKeyboard.style.display?this._emotionKeyboard.style.display="none":this._emotionKeyboard.style.display="block",this._text.focus()}));for(let t=0;t<this._smiles.length;t++)this._smiles[t].addEventListener("click",(()=>{const e=this._smiles[t].innerText||this._smiles[t].textContent;this._text.value+=e,this._editPostError.textContent="",this._text.focus()}));for(let t=0;t<this._install.length;t++)this._install[t].addEventListener("click",(()=>{const e=this._install[t].getAttribute("data-id");window.open(e,"_blank")}))}showPage(){E.getProfile((()=>{T.getFeedPosts(this._postBatchSize),x.getNotifiesCount(!0)}))}_preRender(){this.watingForNewPosts=!1,this._template=Handlebars.templates.feed;for(let t=0;t<C.posts.length;++t)C.posts[t].comments=C.comments.get(C.posts[t].id),C.posts[t].has_next=C.haveCommentsContinuation.get(C.posts[t].id);let t=d;t.avatar_url=N.user.avatar_url,this._context={sideBarData:l,headerData:t,postAreaData:{createPostData:{isCreate:this.isCreate,isEdit:this.isEdit,avatar_url:N.user.avatar_url,jsId:"js-create-post",create:{avatar_url:N.user.avatar_url,attachments:C.attachments,text:C.text,myError:O.editError,buttonData:{text:"Опубликовать",jsId:"js-create-post-btn"},keyboardData:{smiles:k}}},postList:C.posts}},C.text="",this._context.postAreaData.createPostData.isEdit&&(this._context.postAreaData.createPostData.create.text=C.curPost.text_content,this._context.postAreaData.createPostData.create.id=C.curPost.id,this._context.postAreaData.createPostData.create.buttonData={text:"Изменить",jsId:"js-edit-post-btn"}),document.title="Новости"}},SignInView:new class{constructor(){this._addHandlebarsPartial(),this._jsId="sign-in",this.curPage=!1,this._validateEmail=!1,this._validatePassword=!1,N.registerCallback(this.updatePage.bind(this))}_addHandlebarsPartial(){Handlebars.registerPartial("logoPath",Handlebars.templates.logoPath),Handlebars.registerPartial("signInPath",Handlebars.templates.signInPath),Handlebars.registerPartial("button",Handlebars.templates.button),Handlebars.registerPartial("inputField",Handlebars.templates.inputField)}_addPagesElements(){this._emailField=document.getElementById("js-email-input"),this._emailErrorField=document.getElementById("js-email-error"),this._passwordField=document.getElementById("js-password-input"),this._passwordErrorField=document.getElementById("js-password-error"),this._authBtn=document.getElementById("js-sign-in-btn"),this._newBtn=document.getElementById("js-create-account-btn")}_addPagesListener(){this._authBtn.addEventListener("click",(()=>{this._validatePassword&&this._validateEmail?(E.signIn({email:this._emailField.value,password:this._passwordField.value}),N.fields=null):(N.user.errorAuth="Заполните корректно все поля",N.fields={email:this._emailField.value,password:this._passwordField.value},this._render())})),this._newBtn.addEventListener("click",(()=>{t.go("/sign-up",!1)})),this._emailField.addEventListener("input",(()=>{this._validateEmail=F.validation(this._emailField,this._emailErrorField,"email","default")})),this._passwordField.addEventListener("input",(()=>{this._validatePassword=F.validation(this._passwordField,this._passwordErrorField,"password","default")})),N.fields&&(this._validateEmail=F.validation(this._emailField,this._emailErrorField,"email","default"),this._validatePassword=F.validation(this._passwordField,this._passwordErrorField,"password","default"))}remove(){document.getElementById(this._jsId)?.remove(),N.user.errorAuth="",N.fields=null}showPage(){E.checkAuth()}updatePage(){if(this.curPage){if(N.user.isAuth)return void t.go("/feed");this._render()}}_preRender(){this._template=Handlebars.templates.signIn,N.user.errorAuth?(u.errorInfo.errorText=N.user.errorAuth,u.errorInfo.errorClass="display-inline-grid"):(u.errorInfo.errorText="",u.errorInfo.errorClass="display-none"),N.fields&&(u.inputFields[0].text=N.fields.email,u.inputFields[1].text=N.fields.password),this._context={logoData:c,signInData:u},document.title="Авторизация"}_render(){this._preRender(),t.rootElement.innerHTML=this._template(this._context),this._addPagesElements(),this._addPagesListener()}},SignUpView:new class{constructor(){this._addHandlebarsPartial(),this._jsId="sign-up",this.curPage=!1,this._validateFirstName=!1,this._validateLastName=!1,this._validateEmail=!1,this._validatePassword=!1,this._validatePasswordRepeat=!1,N.registerCallback(this.updatePage.bind(this))}_addHandlebarsPartial(){Handlebars.registerPartial("logoPath",Handlebars.templates.logoPath),Handlebars.registerPartial("signUpPath",Handlebars.templates.signUpPath),Handlebars.registerPartial("button",Handlebars.templates.button),Handlebars.registerPartial("inputField",Handlebars.templates.inputField)}_addPagesElements(){this._firstNameField=document.getElementById("js-first-name-input"),this._firstNameErrorField=document.getElementById("js-first-name-error"),this._lastNameField=document.getElementById("js-last-name-input"),this._lastNameErrorField=document.getElementById("js-last-name-error"),this._emailField=document.getElementById("js-email-input"),this._emailErrorField=document.getElementById("js-email-error"),this._passwordField=document.getElementById("js-password-input"),this._passwordErrorField=document.getElementById("js-password-error"),this._passwordRepeatField=document.getElementById("js-repeat-password-input"),this._passwordRepeatErrorField=document.getElementById("js-repeat-password-error"),this._regBtn=document.getElementById("js-sign-up-btn"),this._logBtn=document.getElementById("js-have-account-btn")}_addPagesListener(){this._regBtn.addEventListener("click",(()=>{this._validateFirstName&&this._validateLastName&&this._validateEmail&&this._validatePassword&&this._validatePasswordRepeat?(E.signUp({firstName:this._firstNameField.value,lastName:this._lastNameField.value,email:this._emailField.value,password:this._passwordField.value,password2:this._passwordRepeatField.value}),N.fields=null):(N.user.errorReg="Заполните корректно все поля",N.fields={firstName:this._firstNameField.value,lastName:this._lastNameField.value,email:this._emailField.value,password1:this._passwordField.value,password2:this._passwordRepeatField.value},this._render())})),this._logBtn.addEventListener("click",(()=>{t.go("/sign-in",!1)})),this._firstNameField.addEventListener("input",(()=>{this._validateFirstName=F.validation(this._firstNameField,this._firstNameErrorField,"firstName","default")})),this._lastNameField.addEventListener("input",(()=>{this._validateLastName=F.validation(this._lastNameField,this._lastNameErrorField,"lastName","default")})),this._emailField.addEventListener("input",(()=>{this._validateEmail=F.validation(this._emailField,this._emailErrorField,"email","default")})),this._passwordField.addEventListener("input",(()=>{this._validatePassword=F.validation(this._passwordField,this._passwordErrorField,"password","default")})),this._passwordRepeatField.addEventListener("input",(()=>{this._validatePasswordRepeat=F.validationPassword(this._passwordField,this._passwordRepeatField,this._passwordRepeatErrorField,"default")})),N.fields&&(this._validateFirstName=F.validation(this._firstNameField,this._firstNameErrorField,"firstName","default"),this._validateLastName=F.validation(this._lastNameField,this._lastNameErrorField,"lastName","default"),this._validateEmail=F.validation(this._emailField,this._emailErrorField,"email","default"),this._validatePassword=F.validation(this._passwordField,this._passwordErrorField,"password","default"),this._validatePasswordRepeat=F.validationPassword(this._passwordField,this._passwordRepeatField,this._passwordRepeatErrorField,"default"))}remove(){document.getElementById(this._jsId)?.remove(),N.user.errorReg="",N.fields=null}showPage(){E.checkAuth()}updatePage(){this.curPage&&(N.user.isAuth?(E.getProfile(),t.go("/feed")):this._render())}_preRender(){this._template=Handlebars.templates.signUp,N.user.errorReg?(m.errorInfo.errorText=N.user.errorReg,m.errorInfo.errorClass="display-inline-grid"):(m.errorInfo.errorText="",m.errorInfo.errorClass="display-none"),N.fields&&(m.inputFields[0].text=N.fields.firstName,m.inputFields[1].text=N.fields.lastName,m.inputFields[2].text=N.fields.email,m.inputFields[3].text=N.fields.password1,m.inputFields[4].text=N.fields.password2),this._context={logoData:h,signUpData:m},document.title="Регистрация"}_render(){this._preRender(),t.rootElement.innerHTML=this._template(this._context),this._addPagesElements(),this._addPagesListener()}},FriendsView:new class extends M{constructor(){super(),this._addHandlebarsPartial(),this._jsId="friends",this.curPage=!1,this._friendsBatchSize=15,j.registerCallback(this.updatePage.bind(this)),U.registerCallback(this.updatePage.bind(this)),N.registerCallback(this.updatePage.bind(this)),G.registerCallback(this.updateSearchList.bind(this))}_addHandlebarsPartial(){Handlebars.registerPartial("inputField",Handlebars.templates.inputField),Handlebars.registerPartial("button",Handlebars.templates.button),Handlebars.registerPartial("sideBar",Handlebars.templates.sideBar),Handlebars.registerPartial("header",Handlebars.templates.header),Handlebars.registerPartial("menuItem",Handlebars.templates.menuItem),Handlebars.registerPartial("search",Handlebars.templates.search),Handlebars.registerPartial("friend",Handlebars.templates.friend)}_addPagesElements(){switch(super.addPagesElements(),this._friendsItem.style.color=i,this._friendsImg.style.display="none",this._friendsImgActive.style.display="inline-block",this._exitBtn=document.getElementById("js-exit-btn"),this._settingsBtn=document.getElementById("js-settings-btn"),this._feedBtn=document.getElementById("js-logo-go-feed"),this._friendsBtn=document.getElementById("js-menu-friends"),this._subscribersBtn=document.getElementById("js-menu-subscribers"),this._subscriptionsBtn=document.getElementById("js-menu-subscriptions"),this._findFriendsBtn=document.getElementById("js-menu-find-friends"),this._profile=document.getElementsByClassName("js-go-to-profile"),window.location.pathname){case"/friends":this._friendsBtn.style.color=i;break;case"/subscribers":this._subscribersBtn.style.color=i;break;case"/subscriptions":this._subscriptionsBtn.style.color=i;break;case"/find-friends":this._findFriendsBtn.style.color=i}this._feedBtn=document.getElementById("js-logo-go-feed"),this._myPageItem=document.getElementById("js-side-bar-my-page"),this._newsItem=document.getElementById("js-side-bar-news"),this._msgItem=document.getElementById("js-side-bar-msg"),this._photoItem=document.getElementById("js-side-bar-photo"),this._friendsItem=document.getElementById("js-side-bar-friends"),this._friendsItem.style.color=i,this._groupsItem=document.getElementById("js-side-bar-groups"),this._bookmarksItem=document.getElementById("js-side-bar-bookmarks"),this._goToMsg=document.getElementsByClassName("js-friend-go-msg"),this._deleteFriend=document.getElementsByClassName("friend-menu-item-delete"),this._addUser=document.getElementsByClassName("js-friend-add"),this._unsubUser=document.getElementsByClassName("js-friend-unsub"),this._deleteUser=document.getElementsByClassName("js-friend-delete"),this._usersList=document.getElementById("js-users-list")}_addPagesListener(){this._exitBtn.addEventListener("click",(()=>{E.signOut()})),this._settingsBtn.addEventListener("click",(()=>{t.go("/settings",!1)})),this._myPageItem.addEventListener("click",(()=>{t.go("/user",!1)})),this._msgItem.addEventListener("click",(()=>{t.go("/message",!1)})),this._newsItem.addEventListener("click",(()=>{t.go("/feed",!1)})),this._friendsBtn.addEventListener("click",(()=>{t.go("/friends",!1)})),this._subscribersBtn.addEventListener("click",(()=>{this._subscribersBtn.style.color=i,t.go("/subscribers",!1)})),this._subscriptionsBtn.addEventListener("click",(()=>{this._subscriptionsBtn.style.color=i,t.go("/subscriptions",!1)})),this._findFriendsBtn.addEventListener("click",(()=>{this._findFriendsBtn.style.color=i,t.go("/find-friends",!1)})),this._feedBtn.addEventListener("click",(()=>{t.go("/feed",!1)})),this._groupsItem.addEventListener("click",(()=>{t.go("/groups",!1)}));for(let t=0;t<this._addUser.length;t++)this._addUser[t].addEventListener("click",(()=>{const e=this._addUser[t].getAttribute("data-id");H.sub(e)}));for(let t=0;t<this._deleteFriend.length;t++)this._deleteFriend[t].addEventListener("click",(e=>{const s=this._deleteFriend[t].getAttribute("data-id");H.unsub(s)}));for(let t=0;t<this._unsubUser.length;t++)this._unsubUser[t].addEventListener("click",(e=>{const s=this._unsubUser[t].getAttribute("data-id");H.unsub(s)}));for(let t=0;t<this._deleteUser.length;t++)this._deleteUser[t].addEventListener("click",(()=>{const e=this._deleteUser[t].getAttribute("data-id");H.reject(e)}));for(let e=0;e<this._profile.length;e++)this._profile[e].addEventListener("click",(()=>{const s=this._goToProfile[e].getAttribute("data-id");t.go("/user?link="+s,!1)}));window.onscroll=()=>{if(scrollY+innerHeight>=document.body.scrollHeight&&!this.watingForNewItems){let t=window.location.pathname;"/friends"===t&&U.hasMoreFriends?H.getFriends(N.user.user_link,this._friendsBatchSize,U.friends.length,!0):"/subscribers"===t&&U.hasMoreSubscribers?H.getSubscribers(N.user.user_link,this._friendsBatchSize,U.subscribers.length,!0):"/subscriptions"===t&&U.hasMoreSubscriptions?H.getSubscriptions(N.user.user_link,this._friendsBatchSize,U.subscriptions.length,!0):"/find-friends"===t&&U.hasMoreUsers&&(""===this._searchAreaInput.value.trim()?H.getNotFriends(this._friendsBatchSize,U.notFriends.length,!0):D.search(this._searchAreaInput.value.trim(),this._friendsBatchSize,G.userSearchItems.length,!0)),this.watingForNewItems=!0}};for(let e=0;e<this._goToMsg.length;e++)this._goToMsg[e].addEventListener("click",(()=>{const s=this._goToMsg[e].getAttribute("data-id");S.chatCheck(s,(()=>{localStorage.getItem("chatFriendId")?(localStorage.setItem("chatId",localStorage.getItem("chatFriendId")),t.go("/chat",!1),S.getChatsMsg(null,localStorage.getItem("chatId"),15)):S.chatCreate(s,(()=>{localStorage.getItem("chatId")&&(t.go("/chat",!1),S.getChatsMsg(null,localStorage.getItem("chatId"),15))}))})),event.stopPropagation()}));if("/find-friends"===window.location.pathname)this._searchAreaInput.addEventListener("keyup",(()=>{if(""===this._searchAreaInput.value)return localStorage.removeItem("searchQuery"),void t.go("/find-friends");this.interruptTimer(),this.startTimer(250,(()=>{""!==this._searchAreaInput.value&&(localStorage.setItem("searchQuery",this._searchAreaInput.value),D.search(this._searchAreaInput.value,this._friendsBatchSize))}))}))}remove(){document.getElementById(this._jsId)?.remove()}showPage(){E.getProfile((()=>{x.getNotifiesCount(!0),H.getFriends(N.user.user_link,this._friendsBatchSize,0),H.getNotFriends(this._friendsBatchSize,0),H.getSubscribers(N.user.user_link,this._friendsBatchSize),H.getSubscriptions(N.user.user_link,this._friendsBatchSize)}))}updateSearchList(){this.curPage&&(N.user.isAuth?this._renderNewSearchList():t.go("/sign-in"))}updatePage(){this.curPage&&(N.user.isAuth?this._render():t.go("/sign-in"))}_renderNewSearchList(){this._template=Handlebars.templates.friends;let e,s,i=d;if(i.avatar_url=N.user.avatar_url,"/find-friends"===window.location.pathname)e=G.userSearchItems,s="Запрос не дал результатов";this._context={sideBarData:l,headerData:i,friendsData:e,textInfo:{textInfo:s},menuInfo:p},t.rootElement.innerHTML=this._template(this._context),this._addPagesElements(),this._addPagesListener(),this._searchAreaInput.value=localStorage.getItem("searchQuery"),this._searchAreaInput.focus()}_preRender(){this._template=Handlebars.templates.friends;let t,e,s=d;switch(s.avatar_url=N.user.avatar_url,window.location.pathname){case"/friends":t=U.friends,document.title="Друзья",e="У вас пока нет друзей";break;case"/subscribers":t=U.subscribers,document.title="Подписчики",e="У вас пока нет подписчиков";break;case"/subscriptions":t=U.subscriptions,document.title="Подписки",e="У вас пока нет подписок";break;case"/find-friends":document.title="Поиск друзей",t=U.notFriends}this._context={sideBarData:l,headerData:s,friendsData:t,textInfo:{textInfo:e},menuInfo:p}}_render(){this.watingForNewItems=!1,this._preRender(),t.rootElement.innerHTML=this._template(this._context),this._addPagesElements(),this._addPagesListener();let e=localStorage.getItem("searchQuery");"/find-friends"===window.location.pathname&&null!=e&&""!==e.trim()?(this._searchAreaInput.value=e,this._searchAreaInput.focus(),D.search(this._searchAreaInput.value,this._friendsBatchSize)):(localStorage.removeItem("searchQuery"),this._searchAreaInput.focus())}},GroupsView:new class extends M{constructor(){super(),this._jsId="groups",this._groupsBatchSize=15}addStore(){j.registerCallback(this.updatePage.bind(this)),I.registerCallback(this.updatePage.bind(this)),N.registerCallback(this.updatePage.bind(this)),G.registerCallback(this.updateSearchList.bind(this))}addPagesElements(){switch(super.addPagesElements(),this._groupsItem=document.getElementById("js-side-bar-groups"),this._groupsItem.style.color=i,this._groupsImg.style.display="none",this._groupsImgActive.style.display="inline-block",this._groupsBtn=document.getElementById("js-menu-groups"),this._manageGroupsBtn=document.getElementById("js-menu-manage-groups"),this._findGroupsBtn=document.getElementById("js-menu-find-groups"),this._popularGroupsBtn=document.getElementById("js-menu-popular-groups"),this._goToProfile=document.getElementsByClassName("js-go-to-profile"),this._goToGroup=document.getElementsByClassName("js-go-to-group"),this.newGroupWindow=document.getElementById("newGroup"),window.location.pathname){case"/groups":this._groupsBtn.style.color=i;break;case"/manage-groups":this._manageGroupsBtn.style.color=i;break;case"/find-groups":this._findGroupsBtn.style.color=i;break;case"/popular-groups":this._popularGroupsBtn.style.color=i}this._titleField=document.getElementById("js-title-input"),this._titleErrorField=document.getElementById("js-title-error"),this._infoField=document.getElementById("js-info-input"),this._infoErrorField=document.getElementById("js-info-error"),this._selectField=document.getElementById("js-select"),this._checkboxField=document.getElementById("js-group-checkbox"),this._addGroupBtn=document.getElementById("js-add-group-btn"),this._unsubGroup=document.getElementsByClassName("groupItem-menu-item-delete")}addPagesListener(){this._exitBtn.addEventListener("click",(()=>{E.signOut()})),this._settingsBtn.addEventListener("click",(()=>{t.go("/settings",!1)})),this._groupsItem.addEventListener("click",(()=>{t.go("/groups",!1)})),this._feedBtn.addEventListener("click",(()=>{t.go("/feed",!1)})),this._myPageItem.addEventListener("click",(()=>{t.go("/user",!1)})),this._msgItem.addEventListener("click",(()=>{t.go("/message",!1)})),this._newsItem.addEventListener("click",(()=>{t.go("/feed",!1)})),this._friendsItem.addEventListener("click",(()=>{t.go("/friends",!1)})),this._manageGroupsBtn.addEventListener("click",(()=>{this._manageGroupsBtn.style.color=i,t.go("/manage-groups",!1)})),this._findGroupsBtn.addEventListener("click",(()=>{this._findGroupsBtn.style.color=i,t.go("/find-groups",!1)})),this._groupsBtn.addEventListener("click",(()=>{this._groupsBtn.style.color=i,t.go("/groups",!1)})),this.newGroupWindow.addEventListener("click",(()=>{document.getElementById(y.inputInfo.jsIdError).textContent=""}),!0),window.onscroll=()=>{if(scrollY+innerHeight>=document.body.scrollHeight&&!this.watingForNewItems){let t=window.location.pathname;"/groups"===t&&U.hasMoreFriends?P.getGroups(this._groupsBatchSize,I.groups.length,!0):"/manage-groups"===t&&U.hasMoreSubscribers?P.getmanageGroups(this._groupsBatchSize,I.manageGroups.length,!0):"/find-groups"===t&&U.hasMoreSubscriptions&&(""===this._searchAreaInput.value.trim()?P.getNotGroups(this._groupsBatchSize,I.findGroups.length,!0):D.search(this._searchAreaInput.value.trim(),this._groupsBatchSize,G.communitySearchItems.length,!0)),this.watingForNewItems=!0}},null!==this._addGroupBtn&&this._addGroupBtn.addEventListener("click",(()=>{if(""===this._titleField.value.trim()){return void(document.getElementById(y.inputInfo.jsIdError).textContent="Это поле не может быть пустым")}P.createGroup({title:this._titleField.value,info:this._infoField.value,privacy:"open",hideOwner:!1}),t.go("/manage-groups",!1)}));for(let e=0;e<this._goToGroup.length;e++)this._goToGroup[e].addEventListener("click",(()=>{const s=this._goToGroup[e].getAttribute("data-id");t.go("/group?link="+s,!1)}));if("/find-groups"===window.location.pathname)this._searchAreaInput.addEventListener("keyup",(()=>{if(""===this._searchAreaInput.value)return localStorage.removeItem("searchQuery"),void t.go("/find-groups");this.interruptTimer(),this.startTimer(250,(()=>{""!==this._searchAreaInput.value&&(localStorage.setItem("searchQuery",this._searchAreaInput.value),D.search(this._searchAreaInput.value,this._groupsBatchSize))}))}));for(let t=0;t<this._unsubGroup.length;t++)this._unsubGroup[t].addEventListener("click",(()=>{const e=this._unsubGroup[t].getAttribute("data-id");P.groupUnsub(e),event.stopPropagation()}))}updateSearchList(){this.curPage&&(N.user.isAuth?this._renderNewSearchList():t.go("/sign-in"))}_renderNewSearchList(){this._template=Handlebars.templates.groups;let e,s,i=d;if(i.avatar_url=N.user.avatar_url,"/find-groups"===window.location.pathname)e=G.communitySearchItems,s="Данный запрос не дал результатов";this._context={sideBarData:l,headerData:i,groupsData:e,textInfo:{textInfo:s},groupsPathData:b,menuInfo:p,newGroupData:y},t.rootElement.innerHTML=this._template(this._context),this.addPagesElements(),this.addPagesListener(),this._searchAreaInput.value=localStorage.getItem("searchQuery"),this._searchAreaInput.focus()}showPage(){E.getProfile((()=>{x.getNotifiesCount(!0),P.getGroups(15,0),P.getmanageGroups(15,0),P.getNotGroups(15,0)}))}_preRender(){this.watingForNewItems=!1,this._template=Handlebars.templates.groups;let t,e,s=d;switch(s.avatar_url=N.user.avatar_url,window.location.pathname){case"/groups":t=I.groups,document.title="Подписки",e="Вы не подписаны на сообщества";break;case"/manage-groups":t=I.manageGroups,document.title="Сообщества",e="У вас пока нет сообществ";break;case"/find-groups":t=I.findGroups,document.title="Поиск сообществ",e="Сообщества не найдены";break;case"/popular-groups":t=I.popularGroups,document.title="Поиск сообществ",e="Сообщества не найдены"}this._context={sideBarData:l,headerData:s,groupsData:t,textInfo:{textInfo:e},groupsPathData:b,newGroupData:y,NewGroupError:I.error}}updatePage(){this.curPage&&(N.user.isAuth?(this.render(),this._searchAreaInput.focus()):t.go("/sign-in"))}render(){super.render();let t=localStorage.getItem("searchQuery");"/findGroups"===window.location.pathname&&null!==t&&""!==t.trim()?(this._searchAreaInput.value=t,this._searchAreaInput.focus(),D.search(this._searchAreaInput.value,this._friendsBatchSize)):(localStorage.removeItem("searchQuery"),this._searchAreaInput.focus())}},GroupView:new class extends M{constructor(){super(),this._jsId="group",this._groupLink=null,this._commentBatchToLoad=5,this.isCreate=!1,this.isEdit=!1,this._postsBatchSize=15}addStore(){j.registerCallback(this.updatePage.bind(this)),I.registerCallback(this.updatePage.bind(this)),N.registerCallback(this.updatePage.bind(this)),C.registerCallback(this.updatePage.bind(this)),O.registerCallback(this.updatePage.bind(this))}addPagesElements(){if(super.addPagesElements(),this._groupSettingsBtn=document.getElementById("js-group-settings-btn"),this._groupSub=document.getElementById("js-group-sub-btn"),this._groupUnsub=document.getElementById("js-group-unsub-btn"),this._groupDelete=document.getElementById("js-group-delete-btn"),this._deletePosts=document.getElementsByClassName("post-menu-item-delete"),this._createPosts=document.getElementById("js-create-post"),this._postsTexts=document.getElementsByClassName("post-text"),this._posts=document.getElementsByClassName("post"),this._createPosts=document.getElementById("js-create-post"),this._editPosts=document.getElementsByClassName("post-menu-item-edit"),this._editBtn=document.getElementById("js-edit-post-btn"),this._createBtn=document.getElementById("js-create-post-btn"),this._backBtn=document.getElementById("js-back-post-btn"),this._likePosts=document.getElementsByClassName("post-buttons-like__icon"),this._dislikePosts=document.getElementsByClassName("post-buttons-dislike__icon"),this._addPhotoToPostPic=document.getElementById("js-add-photo-to-post-pic"),this._addPhotoToPost=document.getElementById("js-add-photo-to-post"),this._addSmileToPost=document.getElementById("js-add-smile-to-post"),this._removeImg=document.getElementsByClassName("close-button"),this._commentsAreas=document.getElementsByClassName("comments-area"),this._commentsButtons=document.getElementsByClassName("post-buttons-comment"),this._sendCommentButtons=document.getElementsByClassName("create-comment__send-icon"),this._commentInput=document.getElementsByClassName("comment-input"),this._commentDeleteButton=document.getElementsByClassName("comment-operations__delete"),this._editPostError=document.getElementById("js-edit-post-error"),this._commentEditButton=document.getElementsByClassName("comment-operations__update"),this._commentEditSaveButton=document.getElementsByClassName("submit-comment-edit-button"),this._commentEditCancelButton=document.getElementsByClassName("cancel-comment-edit-button"),this._commentEditInput=document.getElementsByClassName("edit-comment__input"),this._showMoreCommentsButton=document.getElementsByClassName("show-more-block"),this._emotionBtn=document.getElementById("js-post-smiles"),this._emotionKeyboard=document.getElementById("js-smiles-keyboard"),this._smiles=document.getElementsByClassName("js-smile"),this._install=document.getElementsByClassName("js-file-i"),this._text=document.getElementById("js-edit-post-textarea"),this._text){this._text.focus(),this._editBtn=document.getElementById("js-edit-post-btn");let t=document.getElementsByTagName("textarea");t[0].setAttribute("style","height:"+t[0].scrollHeight+"px;"),t[0].addEventListener("input",(function(){this.style.height="auto",this.style.height=this.scrollHeight+"px"}),!1)}}addPagesListener(){super.addPagesListener();for(let t=0;t<this._deletePosts.length;t++)this._deletePosts[t].addEventListener("click",(()=>{const e=this._deletePosts[t].getAttribute("data-id");T.deletePost(Number(e))}));window.onscroll=()=>{scrollY+innerHeight>=document.body.scrollHeight&&!this.watingForNewPosts&&C.hasMorePosts&&(T.getPostsByCommunity(this._groupLink,this._postsBatchSize,C.posts.at(-1).raw_creation_date,!0),this.watingForNewPosts=!0)},this._groupSub&&this._groupSub.addEventListener("click",(()=>{P.groupSub(this._groupLink)})),this._groupUnsub&&this._groupUnsub.addEventListener("click",(()=>{P.groupUnsub(this._groupLink)})),this._groupDelete&&this._groupDelete.addEventListener("click",(()=>{P.deleteGroup(this._groupLink)}));for(let t=0;t<this._likePosts.length;t++)this._likePosts[t].addEventListener("click",(()=>{const e=this._likePosts[t].getAttribute("data-id");T.likePost(Number(e))}));for(let t=0;t<this._dislikePosts.length;t++)this._dislikePosts[t].addEventListener("click",(()=>{const e=this._dislikePosts[t].getAttribute("data-id");T.dislikePost(Number(e))}));for(let t=0;t<this._commentsButtons.length;t++)this._commentsButtons[t].addEventListener("click",(()=>{if(void 0===C.comments.get(C.posts[t].id)||0===C.comments.get(C.posts[t].id).length)T.getComments(C.posts[t].id,this._commentBatchToLoad);else{C.comments.delete(C.posts[t].id),this._posts[t].getElementsByClassName("comments-list")[0].style.display="none";let e=this._commentsAreas[t].getElementsByClassName("show-more-block");0!==e.length&&(this._commentsAreas[t].removeChild(e[0]),C.haveCommentsContinuation.delete(C.posts[t].id))}}));for(let t=0;t<this._sendCommentButtons.length;++t)this._sendCommentButtons[t].addEventListener("click",(()=>{""!==this._commentInput[t].textContent.trim()&&T.createComment(C.posts[t].id,this._commentInput[t].textContent.trim(),null)}));for(let t=0;t<this._commentInput.length;++t)this._commentInput[t].addEventListener("keyup",(e=>{""!==this._commentInput[t].textContent.trim()&&"Enter"===e.code&&document.activeElement===this._commentInput[t]&&T.createComment(C.posts[t].id,this._commentInput[t].textContent.trim(),null)}));for(let t=0;t<this._commentDeleteButton.length;++t)this._commentDeleteButton[t].addEventListener("click",(()=>{let e=this._commentDeleteButton[t].getAttribute("data-comment-id");T.deleteComment(e);let s=Number(this._commentDeleteButton[t].getAttribute("data-post-id")),i=C.comments.get(s);for(let t=0;t<i.length;++t)if(i[t].id===Number(e)){i.splice(t,1);break}C.comments.set(s,i);for(let t=0;t<C.posts.length;++t)C.posts[t].id===s&&C.posts[t].comments_amount--;this.updatePage()}));for(let t=0;t<this._commentEditButton.length;++t)this._commentEditButton[t].addEventListener("click",(()=>{let e=Number(this._commentDeleteButton[t].getAttribute("data-post-id")),s=C.comments.get(e),i=Number(this._commentDeleteButton[t].getAttribute("data-comment-id"));for(let t=0;t<s.length;++t)s[t].id===i&&(s[t].editing_mode=!0,s[t].cur_comment=s[t].text);this.updatePage()}));for(let t=0;t<this._commentEditSaveButton.length;++t)this._commentEditSaveButton[t].addEventListener("click",(()=>{let e=this._commentEditInput[t].textContent.trim();if(""!==this._commentEditInput[t].textContent.trim()){let s=Number(this._commentEditSaveButton[t].getAttribute("data-comment-id"));T.editComment(s,e);let i=Number(this._commentEditSaveButton[t].getAttribute("data-post-id")),a=C.comments.get(i);for(let t=0;t<a.length;++t)a[t].id===s&&(a[t].editing_mode=!1,a[t].text=e)}}));for(let t=0;t<this._commentEditCancelButton.length;++t)this._commentEditCancelButton[t].addEventListener("click",(()=>{let e=Number(this._commentEditSaveButton[t].getAttribute("data-comment-id")),s=Number(this._commentEditSaveButton[t].getAttribute("data-post-id")),i=C.comments.get(s);for(let t=0;t<i.length;++t)i[t].id===e&&(i[t].editing_mode=!1);this.updatePage()}));for(let t=0;t<this._showMoreCommentsButton.length;++t)this._showMoreCommentsButton[t].addEventListener("click",(()=>{let e=Number(this._showMoreCommentsButton[t].getAttribute("data-post-id")),s=C.comments.get(e).at(-1).raw_creation_date;for(let t=0;t<C.posts.length;++t)if(C.posts[t].id===e){T.getComments(e,this._commentBatchToLoad,s);break}}));for(let t=0;t<this._postsTexts.length;t++){const e=this._postsTexts[t].textContent;if(e.split("\n").length>3||e.length>a){const s=this._postsTexts[t];let i;if(e.length>a)i=e.slice(0,a)+"...";else{const t=e.indexOf("\n",e.indexOf("\n",e.indexOf("\n")+1)+1);i=e.slice(0,t)+"..."}s.textContent=i;const r=document.createElement("div");r.textContent="Показать еще",r.style.color="#9747FF",r.style.cursor="pointer",s.appendChild(r),r.addEventListener("click",(function(){s.textContent=e}))}}this._groupSettingsBtn&&this._groupSettingsBtn.addEventListener("click",(()=>{t.go("/settings-group",!1)}));for(let t=0;t<this._editPosts.length;t++)this._editPosts[t].addEventListener("click",(()=>{this.isEdit=this._editPosts[t].getAttribute("data-id"),this.isCreate=!1,O.editError="",this._editPostError="",T.getPostsById(this.isEdit,1)}));this._createPosts&&this._createPosts.addEventListener("click",(()=>{this.isCreate=!0,this.isEdit=!1,O.editError="",this._editPostError="",super.render(),this._text.focus()})),this._addPhotoToPost&&this._addPhotoToPost.addEventListener("click",(()=>{this._createPosts.click(),this._addPhotoToPostPic.click()})),this._addSmileToPost&&this._addSmileToPost.addEventListener("click",(()=>{this._createPosts.click(),this._emotionBtn.click()})),this._editBtn&&this._editBtn.addEventListener("click",(()=>{T.editPost(this._text.value,this.isEdit),this.isEdit=!1})),this._createBtn&&this._createBtn.addEventListener("click",(()=>{""===this._text.value&&0===C.attachments.length?this._editPostError.textContent="Запись не может быть пустой":(this._editPostError.textContent="",T.createPostCommunity(N.user.user_link,this._groupLink,!0,this._text.value),this.isCreate=!1)})),this._text&&this._text.addEventListener("input",(()=>{this._editPostError.textContent=""})),this._backBtn&&this._backBtn.addEventListener("click",(()=>{this.isCreate=this.isEdit=!1,C.attachments=[],O.editError="",super.render()})),this._addPhotoToPostPic&&this._addPhotoToPostPic.addEventListener("click",(()=>{if(null===C.attachments&&(C.attachments=[]),C.attachments.length>=10)return;C.text=this._text.value;const e=document.createElement("input");e.type="file",e.addEventListener("change",(function(e){const i=e.target.files[0],a=new FileReader;a.onload=function(e){q.uploadImg(i,(e=>{let a=1;C.attachments.length&&(a=C.attachments[C.attachments.length-1].id+1),"img"===t._getSearch(e).type?(C.attachments.push({url:s.imgUrlConvert(e),id:a,type:"img"}),C.addAttachments.push(e)):(C.attachments.push({url:s.imgUrlConvert(e),id:a,type:"file",filename:i.name}),C.addAttachments.push(e+`&filename=${i.name}`)),C._refreshStore()}))},a.readAsDataURL(i)})),e.click()}));for(let t=0;t<this._removeImg.length;t++)this._removeImg[t].addEventListener("click",(()=>{const e=this._removeImg[t].getAttribute("data-id");let i=-1;for(let t=0;t<C.attachments.length;t++)if(C.attachments[t].id.toString()===e){i=t,C.deleteAttachments.push(s.imgUrlBackConvert(C.attachments[t].url));break}i>-1&&C.attachments.splice(i,1),C.text=this._text.value,C._refreshStore()}));this._emotionBtn&&this._emotionBtn.addEventListener("click",(()=>{"block"===this._emotionKeyboard.style.display?this._emotionKeyboard.style.display="none":this._emotionKeyboard.style.display="block",this._text.focus()}));for(let t=0;t<this._smiles.length;t++)this._smiles[t].addEventListener("click",(()=>{const e=this._smiles[t].innerText||this._smiles[t].textContent;this._text.value+=e,this._editPostError.textContent="",this._text.focus()}));for(let t=0;t<this._install.length;t++)this._install[t].addEventListener("click",(()=>{const e=this._install[t].getAttribute("data-id");window.open(e,"_blank")}))}showPage(e){e.link?(this._groupLink=e.link,localStorage.setItem("groupLink",this._groupLink),E.getProfile((()=>{P.getGroupInfo((()=>{T.getPostsByCommunity(this._groupLink,this._postsBatchSize),x.getNotifiesCount(!0),P.getGroupsSub(this._groupLink,3)}),this._groupLink)}))):t.go("/groups",!1)}_preRender(){this.watingForNewPosts=!1,this._template=Handlebars.templates.group;let t=d;t.avatar_url=N.user.avatar_url;for(let t=0;t<C.posts.length;++t)C.posts[t].comments=C.comments.get(C.posts[t].id),C.posts[t].has_next=C.haveCommentsContinuation.get(C.posts[t].id);this._context={sideBarData:l,headerData:t,groupData:I.curGroup,postAreaData:{createPostData:{displayNone:!I.curGroup.isAdmin,isCreate:this.isCreate,isEdit:this.isEdit,avatar_url:I.curGroup.avatar_url,user_avatar_url:N.user.avatar_url,jsId:"js-create-post",create:{avatar_url:I.curGroup.avatar_url,attachments:C.attachments,text:C.text,myError:O.editError,buttonData:{text:"Опубликовать",jsId:"js-create-post-btn"},keyboardData:{smiles:k}}},postList:C.posts}},C.text="";const e=this._context.groupData.avg_avatar_color;if(e){const t=e.split(" ");2===t.length&&(this._context.groupData.avg_color1=t[0],this._context.groupData.avg_color2=t[1])}this._context.postAreaData.createPostData.isEdit&&(this._context.postAreaData.createPostData.create.text=C.curPost.text_content,this._context.postAreaData.createPostData.create.id=C.curPost.id,this._context.postAreaData.createPostData.create.buttonData={text:"Изменить",jsId:"js-edit-post-btn"}),I.curGroup?document.title=I.curGroup.title:document.title="Группа"}},ProfileView:new class extends M{constructor(){super(),this._jsId="profile",this.curPage=!1,this._userLink=null,this._commentBatchToLoad=5,this.isCreate=!1,this.isEdit=!1,this._postsBatchSize=15}addStore(){j.registerCallback(this.updatePage.bind(this)),C.registerCallback(this.updatePage.bind(this)),N.registerCallback(this.updatePage.bind(this)),U.registerCallback(this.updatePage.bind(this)),O.registerCallback(this.updatePage.bind(this))}addPagesElements(){if(super.addPagesElements(),N.user.user_link===this._userLink&&(this._myPageItem.style.color=i,this._myPageImg.style.display="none",this._myPageImgActive.style.display="inline-block"),this._profileSettingsBtn=document.getElementById("js-profile-settings-btn"),this._createPosts=document.getElementById("js-create-post"),this._editPosts=document.getElementsByClassName("post-menu-item-edit"),this._editBtn=document.getElementById("js-edit-post-btn"),this._createBtn=document.getElementById("js-create-post-btn"),this._backBtn=document.getElementById("js-back-post-btn"),this._removeFriend=document.getElementById("js-friend-remove"),this._addFriend=document.getElementById("js-friend-add"),this._deletePosts=document.getElementsByClassName("post-menu-item-delete"),this._likePosts=document.getElementsByClassName("post-buttons-like__icon"),this._dislikePosts=document.getElementsByClassName("post-buttons-dislike__icon"),this._goMsg=document.getElementById("js-go-msg"),this._addPhotoToPostPic=document.getElementById("js-add-photo-to-post-pic"),this._addPhotoToPost=document.getElementById("js-add-photo-to-post"),this._addSmileToPost=document.getElementById("js-add-smile-to-post"),this._removeImg=document.getElementsByClassName("close-button"),this._dropContent=document.getElementById("js-drop-content"),this._postsTexts=document.getElementsByClassName("post-text"),this._posts=document.getElementsByClassName("post"),this._commentsAreas=document.getElementsByClassName("comments-area"),this._commentsButtons=document.getElementsByClassName("post-buttons-comment"),this._sendCommentButtons=document.getElementsByClassName("create-comment__send-icon"),this._commentInput=document.getElementsByClassName("comment-input"),this._commentDeleteButton=document.getElementsByClassName("comment-operations__delete"),this._editPostError=document.getElementById("js-edit-post-error"),this._commentEditButton=document.getElementsByClassName("comment-operations__update"),this._commentEditSaveButton=document.getElementsByClassName("submit-comment-edit-button"),this._commentEditCancelButton=document.getElementsByClassName("cancel-comment-edit-button"),this._commentEditInput=document.getElementsByClassName("edit-comment__input"),this._showMoreCommentsButton=document.getElementsByClassName("show-more-block"),this._emotionBtn=document.getElementById("js-post-smiles"),this._emotionKeyboard=document.getElementById("js-smiles-keyboard"),this._smiles=document.getElementsByClassName("js-smile"),this._install=document.getElementsByClassName("js-file-i"),this._text=document.getElementById("js-edit-post-textarea"),this._text){this._text.focus(),this._editBtn=document.getElementById("js-edit-post-btn");let t=document.getElementsByTagName("textarea");t[0].setAttribute("style","height:"+t[0].scrollHeight+"px;"),t[0].addEventListener("input",(function(){this.style.height="auto",this.style.height=this.scrollHeight+"px"}),!1)}}addPagesListener(){super.addPagesListener(),window.onscroll=()=>{scrollY+innerHeight>=document.body.scrollHeight&&!this.watingForNewPosts&&C.hasMorePosts&&(T.getPostsByUser(this._userLink,this._postsBatchSize,C.posts.at(-1).raw_creation_date,!0),this.watingForNewPosts=!0)},this._settingsBtn.addEventListener("click",(()=>{t.go("/settings",!1)})),this._profileSettingsBtn&&this._profileSettingsBtn.addEventListener("click",(()=>{t.go("/settings",!1)}));for(let t=0;t<this._deletePosts.length;t++)this._deletePosts[t].addEventListener("click",(()=>{const e=this._deletePosts[t].getAttribute("data-id");T.deletePost(Number(e))}));for(let t=0;t<this._likePosts.length;t++)this._likePosts[t].addEventListener("click",(()=>{const e=this._likePosts[t].getAttribute("data-id");T.likePost(Number(e))}));for(let t=0;t<this._dislikePosts.length;t++)this._dislikePosts[t].addEventListener("click",(()=>{const e=this._dislikePosts[t].getAttribute("data-id");T.dislikePost(Number(e))}));this._goMsg&&this._goMsg.addEventListener("click",(()=>{const e=this._goMsg.getAttribute("data-id");S.chatCheck(e,(()=>{localStorage.getItem("chatFriendId")?(localStorage.setItem("chatId",localStorage.getItem("chatFriendId")),t.go("/chat",!1),S.getChatsMsg(null,localStorage.getItem("chatId"),15)):S.chatCreate(e,(()=>{localStorage.getItem("chatId")&&(t.go("/chat",!1),S.getChatsMsg(null,localStorage.getItem("chatId"),15))}))}))}));for(let t=0;t<this._commentsButtons.length;t++)this._commentsButtons[t].addEventListener("click",(()=>{if(void 0===C.comments.get(C.posts[t].id)||0===C.comments.get(C.posts[t].id).length)T.getComments(C.posts[t].id,this._commentBatchToLoad);else{C.comments.delete(C.posts[t].id),this._posts[t].getElementsByClassName("comments-list")[0].style.display="none";let e=this._commentsAreas[t].getElementsByClassName("show-more-block");0!==e.length&&(this._commentsAreas[t].removeChild(e[0]),C.haveCommentsContinuation.delete(C.posts[t].id))}}));for(let t=0;t<this._sendCommentButtons.length;++t)this._sendCommentButtons[t].addEventListener("click",(()=>{""!==this._commentInput[t].textContent.trim()&&T.createComment(C.posts[t].id,this._commentInput[t].textContent.trim(),null)}));for(let t=0;t<this._commentInput.length;++t)this._commentInput[t].addEventListener("keyup",(e=>{""!==this._commentInput[t].textContent.trim()&&"Enter"===e.code&&document.activeElement===this._commentInput[t]&&T.createComment(C.posts[t].id,this._commentInput[t].textContent.trim(),null)}));for(let t=0;t<this._commentDeleteButton.length;++t)this._commentDeleteButton[t].addEventListener("click",(()=>{let e=this._commentDeleteButton[t].getAttribute("data-comment-id");T.deleteComment(e);let s=Number(this._commentDeleteButton[t].getAttribute("data-post-id")),i=C.comments.get(s);for(let t=0;t<i.length;++t)if(i[t].id===Number(e)){i.splice(t,1);break}C.comments.set(s,i);for(let t=0;t<C.posts.length;++t)C.posts[t].id===s&&C.posts[t].comments_amount--;this.updatePage()}));for(let t=0;t<this._commentEditButton.length;++t)this._commentEditButton[t].addEventListener("click",(()=>{let e=Number(this._commentDeleteButton[t].getAttribute("data-post-id")),s=C.comments.get(e),i=Number(this._commentDeleteButton[t].getAttribute("data-comment-id"));for(let t=0;t<s.length;++t)s[t].id===i&&(s[t].editing_mode=!0,s[t].cur_comment=s[t].text);this.updatePage()}));for(let t=0;t<this._commentEditSaveButton.length;++t)this._commentEditSaveButton[t].addEventListener("click",(()=>{let e=this._commentEditInput[t].textContent.trim();if(""!==this._commentEditInput[t].textContent.trim()){let s=Number(this._commentEditSaveButton[t].getAttribute("data-comment-id"));T.editComment(s,e);let i=Number(this._commentEditSaveButton[t].getAttribute("data-post-id")),a=C.comments.get(i);for(let t=0;t<a.length;++t)a[t].id===s&&(a[t].editing_mode=!1,a[t].text=e)}}));for(let t=0;t<this._commentEditCancelButton.length;++t)this._commentEditCancelButton[t].addEventListener("click",(()=>{let e=Number(this._commentEditSaveButton[t].getAttribute("data-comment-id")),s=Number(this._commentEditSaveButton[t].getAttribute("data-post-id")),i=C.comments.get(s);for(let t=0;t<i.length;++t)i[t].id===e&&(i[t].editing_mode=!1);this.updatePage()}));for(let t=0;t<this._showMoreCommentsButton.length;++t)this._showMoreCommentsButton[t].addEventListener("click",(()=>{let e=Number(this._showMoreCommentsButton[t].getAttribute("data-post-id")),s=C.comments.get(e).at(-1).raw_creation_date;for(let t=0;t<C.posts.length;++t)if(C.posts[t].id===e){T.getComments(e,this._commentBatchToLoad,s);break}}));for(let t=0;t<this._postsTexts.length;t++){const e=this._postsTexts[t].textContent;if(e.split("\n").length>3||e.length>a){const s=this._postsTexts[t];let i;if(e.length>a)i=e.slice(0,a)+"...";else{const t=e.indexOf("\n",e.indexOf("\n",e.indexOf("\n")+1)+1);i=e.slice(0,t)+"..."}s.textContent=i;const r=document.createElement("div");r.textContent="Показать еще",r.style.color="#9747FF",r.style.cursor="pointer",s.appendChild(r),r.addEventListener("click",(function(){s.textContent=e}))}}for(let t=0;t<this._editPosts.length;t++)this._editPosts[t].addEventListener("click",(()=>{this.isEdit=this._editPosts[t].getAttribute("data-id"),this.isCreate=!1,C.attachments=[],C.addAttachments=[],C.deleteAttachments=[],O.editError="",this._editPostError="",T.getPostsById(this.isEdit,1)}));this._createPosts&&this._createPosts.addEventListener("click",(t=>{t.stopPropagation(),this.isCreate=!0,this.isEdit=!1,C.attachments=[],C.addAttachments=[],C.deleteAttachments=[],O.editError="",this._editPostError="",super.render(),this._text.focus()}),!0),this._addPhotoToPost&&this._addPhotoToPost.addEventListener("click",(()=>{this._createPosts.click(),this._addPhotoToPostPic.click()})),this._addSmileToPost&&this._addSmileToPost.addEventListener("click",(()=>{this._createPosts.click(),this._emotionBtn.click()})),this._editBtn&&this._editBtn.addEventListener("click",(()=>{T.editPost(this._text.value,this.isEdit),this.isEdit=!1})),this._createBtn&&this._createBtn.addEventListener("click",(()=>{""===this._text.value&&0===C.attachments.length?this._editPostError.textContent="Запись не может быть пустой":(this._editPostError.textContent="",T.createPostUser(N.user.user_link,N.userProfile.user_link,!0,this._text.value),this.isCreate=!1)})),this._text&&this._text.addEventListener("input",(()=>{this._editPostError.textContent=""})),this._backBtn&&this._backBtn.addEventListener("click",(()=>{this.isCreate=this.isEdit=!1,C.attachments=[],C.addAttachments=[],C.deleteAttachments=[],O.editError="",super.render()})),this._addFriend&&this._addFriend.addEventListener("click",(()=>{const t=this._addFriend.getAttribute("data-id");H.sub(t)})),this._removeFriend&&this._removeFriend.addEventListener("click",(()=>{const t=this._removeFriend.getAttribute("data-id");H.unsub(t)})),this._addPhotoToPostPic&&this._addPhotoToPostPic.addEventListener("click",(()=>{if(null===C.attachments&&(C.attachments=[]),C.attachments.length>=10)return;C.text=this._text.value;const e=document.createElement("input");e.type="file",e.addEventListener("change",(function(e){const i=e.target.files[0],a=new FileReader;a.onload=function(e){q.uploadImg(i,(e=>{let a=1;C.attachments.length&&(a=C.attachments[C.attachments.length-1].id+1),"img"===t._getSearch(e).type?(C.attachments.push({url:s.imgUrlConvert(e),id:a,type:"img"}),C.addAttachments.push(e)):(C.attachments.push({url:s.imgUrlConvert(e),id:a,type:"file",filename:i.name}),C.addAttachments.push(e+`&filename=${i.name}`)),C._refreshStore()}))},a.readAsDataURL(i)})),e.click()}));for(let t=0;t<this._removeImg.length;t++)this._removeImg[t].addEventListener("click",(()=>{const e=this._removeImg[t].getAttribute("data-id");let i=-1;for(let t=0;t<C.attachments.length;t++)if(C.attachments[t].id.toString()===e){i=t,C.deleteAttachments.push(s.imgUrlBackConvert(C.attachments[t].url));break}i>-1&&C.attachments.splice(i,1),C.text=this._text.value,C._refreshStore()}));this._emotionBtn&&this._emotionBtn.addEventListener("click",(()=>{"block"===this._emotionKeyboard.style.display?this._emotionKeyboard.style.display="none":this._emotionKeyboard.style.display="block",this._text.focus()}));for(let t=0;t<this._smiles.length;t++)this._smiles[t].addEventListener("click",(()=>{const e=this._smiles[t].innerText||this._smiles[t].textContent;this._text.value+=e,this._editPostError.textContent="",this._text.focus()}));for(let t=0;t<this._install.length;t++)this._install[t].addEventListener("click",(()=>{const e=this._install[t].getAttribute("data-id");window.open(e,"_blank")}))}showPage(e){e.link?(this._userLink=e.link,E.getProfile((()=>{T.getPostsByUser(this._userLink,this._postsBatchSize),x.getNotifiesCount(!0)}),this._userLink)):E.getProfile((()=>{this._userLink=N.user.user_link,t.go("/user?link="+N.user.user_link,!0),x.getNotifiesCount(!0)})),E.getProfile(),H.isFriend(e.link)}_preRender(){this.watingForNewPosts=!1,this._template=Handlebars.templates.profile,N.userProfile.isMyPage=!0,this._userLink===N.user.user_link||null==this._userLink?N.userProfile=N.user:N.userProfile.isMyPage=!1;for(let t=0;t<C.posts.length;++t)C.posts[t].comments=C.comments.get(C.posts[t].id),C.posts[t].has_next=C.haveCommentsContinuation.get(C.posts[t].id);let t=d;t.avatar_url=N.user.avatar_url,this._context={sideBarData:l,headerData:t,profileData:N.userProfile,postAreaData:{createPostData:{displayNone:!("friend"===U.isMyFriend||N.userProfile.isMyPage),isCreate:this.isCreate,isEdit:this.isEdit,avatar_url:N.user.avatar_url,jsId:"js-create-post",create:{avatar_url:N.user.avatar_url,attachments:C.attachments,text:C.text,myError:O.editError,buttonData:{text:"Опубликовать",jsId:"js-create-post-btn"},keyboardData:{smiles:k}}},postList:C.posts}},C.text="";const e=this._context.profileData.avg_avatar_color;if(e){const t=e.split(" ");2==t.length&&(this._context.profileData.avg_color1=t[0],this._context.profileData.avg_color2=t[1])}this._context.profileData.isMyFriend=U.isMyFriend,this._context.postAreaData.createPostData.isEdit&&(this._context.postAreaData.createPostData.create.text=C.curPost.text_content,this._context.postAreaData.createPostData.create.id=C.curPost.id,this._context.postAreaData.createPostData.create.buttonData={text:"Изменить",jsId:"js-edit-post-btn"}),document.title=N.userProfile.firstName}},SettingsGroupView:new class extends M{constructor(){super(),this._jsId="settingsGroup",this._groupLink=null,this._validateTitle=!0,this._validateInfo=!0,this._reader=new FileReader,this._fileList=null,this._groupLink=null}addStore(){j.registerCallback(this.updatePage.bind(this)),I.registerCallback(this.updatePage.bind(this)),N.registerCallback(this.updatePage.bind(this))}addPagesElements(){super.addPagesElements(),this._dropArea=document.getElementById("js-drop-zone"),this._dropContent=document.getElementById("js-drop-content"),this._titleField=document.getElementById("js-title-input"),this._titleErrorField=document.getElementById("js-title-error"),this._infoField=document.getElementById("js-info-input"),this._infoErrorField=document.getElementById("js-info-error"),this._typeField=document.getElementById("js-type-input"),this._showAuthorField=document.getElementById("js-showAuthor-input"),this._input=document.getElementById("js-select-file"),this._input.setAttribute("accept",o.join(",")),this._saveBtn=document.getElementById("js-settings-save-btn"),this._groupSettingsBtn=document.getElementById("js-group-settings"),this._groupSettingsBtn.style.color=i,this._subBtn=document.getElementById("js-menu-subscribers"),this._requestsBtn=document.getElementById("js-menu-requests"),this._deleteGroup=document.getElementById("js-group-delete-btn"),this._goToGroupBtn=document.getElementById("js-go-to-group-btn"),this._error=document.getElementById("js-sign-in-error")}addPagesListener(){super.addPagesListener(),this._goToGroupBtn.addEventListener("click",(()=>{t.goBack()})),this._groupSettingsBtn&&this._groupSettingsBtn.addEventListener("click",(()=>{t.go("/settings-group",!1)})),this._dropArea.addEventListener("dragover",(t=>{t.preventDefault()})),this._dropArea.addEventListener("drop",(t=>{t.preventDefault(),this._fileList=t.dataTransfer.files[0],this._dropContent.innerHTML="",this._reader.readAsDataURL(this._fileList),this._reader.addEventListener("load",(t=>{this._dropContent.src=t.target.result}))})),this._dropArea.addEventListener("click",(()=>{this._input.click()})),this._input.addEventListener("change",(t=>{t.target.files.length&&(this._fileList=Array.from(t.target.files),this._fileList=this._fileList[0],this._dropContent.innerHTML="",this._reader.readAsDataURL(this._fileList),this._reader.addEventListener("load",(t=>{this._dropContent.src=t.target.result})))})),this._saveBtn.addEventListener("click",(()=>{let t="open";this._validateTitle&&this._validateInfo?(this._error.textContent="",this._error.classList.remove("display-inline-grid"),this._error.classList.remove("font-color-error"),this._error.classList.add("display-none"),this._fileList?q.uploadImg(this._fileList,(e=>{P.editGroup({link:this._groupLink,avatar:e,title:this._titleField.value,info:this._infoField.value,privacy:t,hideOwner:!1})})):P.editGroup({link:this._groupLink,title:this._titleField.value,info:this._infoField.value,privacy:t,hideOwner:!1})):(this._error.textContent="Заполните корректно все поля",this._error.classList.add("display-inline-grid"),this._error.classList.add("font-color-error"),this._error.classList.remove("font-color-ok"),this._error.classList.remove("display-none"))})),this._deleteGroup.addEventListener("click",(()=>{P.deleteGroup(this._groupLink),t.go("/manage-groups",!1)})),this._titleField.addEventListener("input",(()=>{this._validateTitle=F.validation(this._titleField,this._titleErrorField,"title","settings")})),this._infoField.addEventListener("input",(()=>{this._validateInfo=F.validation(this._infoField,this._infoErrorField,"bio","settings")}))}showPage(){localStorage.getItem("groupLink")?this._groupLink=localStorage.getItem("groupLink"):t.goBack(),this._groupLink&&E.getProfile((()=>{P.getGroupInfo((()=>{I.curGroup.isAdmin?this._groupLink=I.curGroup.link:t.goBack()}),this._groupLink),x.getNotifiesCount(!0)}))}_preRender(){this._template=Handlebars.templates.settingsGroup;let t=d;t.avatar_url=N.user.avatar_url;let e=v;e.avatar_url=I.curGroup.avatar_url,e.inputInfo.data=I.curGroup.title,e.info=I.curGroup.info,"open"===I.curGroup.privacy?e.type=!0:e.type=!1,e.showAuthor=I.curGroup.hideOwner,I.editStatus&&I.editMsg?(e.errorInfo.errorText=I.editMsg,e.errorInfo.errorClass="display-inline-grid font-color-ok"):!I.editStatus&&I.editMsg?(e.errorInfo.errorText=I.editMsg,e.errorInfo.errorClass="display-inline-grid font-color-error"):(e.errorInfo.errorText="",e.errorInfo.errorClass="display-none"),this._context={sideBarData:l,headerData:t,settingsPathData:e},document.title="Настройки группы"}},SettingsView:new class extends M{constructor(){super(),this._jsId="settings",this.curPage=!1,this._validateFirstName=!0,this._validateLastName=!0,this._validateStatus=!0,this._validateBio=!0,this._validateBirthday=!0,this._reader=new FileReader,this._fileList=null}addStore(){j.registerCallback(this.updatePage.bind(this)),N.registerCallback(this.updatePage.bind(this))}addPagesElements(){super.addPagesElements(),this._settingsBtn=document.getElementById("js-menu-main"),this._safetyBtn=document.getElementById("js-menu-safety"),this._settingsBtn.style.color=i,this._input=document.getElementById("js-select-file"),this._input.setAttribute("accept",o.join(",")),this._dropZone=document.getElementById("js-drop-zone"),this._dropContent=document.getElementById("js-drop-content"),this._firstNameField=document.getElementById("js-first-name-input"),this._firstNameErrorField=document.getElementById("js-first-name-error"),this._lastNameField=document.getElementById("js-last-name-input"),this._lastNameErrorField=document.getElementById("js-last-name-error"),this._bioField=document.getElementById("js-bio-input"),this._bioErrorField=document.getElementById("js-bio-error"),this._birthdayField=document.getElementById("js-birthday-input"),this._birthdayErrorField=document.getElementById("js-birthday-error"),this._statusField=document.getElementById("js-status-input"),this._statusErrorField=document.getElementById("js-status-error"),this._saveBtn=document.getElementById("js-settings-save-btn"),this._groupsItem=document.getElementById("js-side-bar-groups"),this._saveInfo=document.getElementById("js-save-info"),this._error=document.getElementById("js-sign-in-error"),this._orOff=document.getElementById("js-or-off")}addPagesListener(){super.addPagesListener(),this._dropZone.addEventListener("dragover",(t=>{t.preventDefault()})),this._dropZone.addEventListener("drop",(t=>{t.preventDefault(),this._fileList=t.dataTransfer.files[0],this._dropContent.innerHTML="",this._reader.readAsDataURL(this._fileList),this._reader.addEventListener("load",(t=>{this._dropContent.src=t.target.result}))})),this._dropZone.addEventListener("click",(()=>{this._input.click()})),this._input.addEventListener("change",(t=>{if(t.target.files.length){if(!t.target.files[0].type.startsWith("image/"))return this._error.textContent="Ставить на аватарку можно только картинки",this._error.classList.add("display-inline-grid"),this._error.classList.add("font-color-error"),this._error.classList.remove("font-color-ok"),void this._error.classList.remove("display-none");this._fileList=Array.from(t.target.files),this._fileList=this._fileList[0],this._dropContent.innerHTML="",this._reader.readAsDataURL(this._fileList),this._reader.addEventListener("load",(t=>{this._dropContent.src=t.target.result}))}})),this._saveBtn.addEventListener("click",(()=>{if(this._validateFirstName&&this._validateLastName&&this._validateStatus&&this._validateBio&&this._validateBirthday){let t;this._error.textContent="",this._error.classList.remove("display-inline-grid"),this._error.classList.remove("font-color-error"),this._error.classList.add("display-none"),this._birthdayField.value&&(t=new Date(this._birthdayField.value).toISOString()),this._fileList?q.uploadImg(this._fileList,(e=>{E.editProfile({avatar_url:e,firstName:this._firstNameField.value,lastName:this._lastNameField.value,bio:this._bioField.value,birthday:t,status:this._statusField.value})})):E.editProfile({firstName:this._firstNameField.value,lastName:this._lastNameField.value,bio:this._bioField.value,birthday:t,status:this._statusField.value})}else this._error.textContent="Заполните корректно все поля",this._error.classList.add("display-inline-grid"),this._error.classList.add("font-color-error"),this._error.classList.remove("font-color-ok"),this._error.classList.remove("display-none")})),this._firstNameField.addEventListener("input",(()=>{this._validateFirstName=F.validation(this._firstNameField,this._firstNameErrorField,"firstName","settings")})),this._lastNameField.addEventListener("input",(()=>{this._validateLastName=F.validation(this._lastNameField,this._lastNameErrorField,"lastName","settings")})),this._statusField.addEventListener("input",(()=>{this._validateStatus=F.validation(this._statusField,this._statusErrorField,"userStatus","settings")})),this._bioField.addEventListener("input",(()=>{this._validateBio=F.validation(this._bioField,this._bioErrorField,"bio","settings")})),this._birthdayField.addEventListener("input",(()=>{this._validateBirthday=F.validation(this._birthdayField,this._birthdayErrorField,"birthday","settings")})),this._orOff&&this._orOff.addEventListener("click",(()=>{"true"===localStorage.getItem("or-off")?localStorage.setItem("or-off","false"):localStorage.setItem("or-off","true")}))}showPage(){E.getProfile((()=>{x.getNotifiesCount(!0)}))}_preRender(){this._template=Handlebars.templates.settings;let t=d;t.avatar_url=N.user.avatar_url;let e=g;e.orOff=localStorage.getItem("or-off"),e.avatar_url=N.user.avatar_url,e.inputFields[0].data=N.user.firstName,e.inputFields[1].data=N.user.lastName,e.inputFields[2].data=N.user.bio,N.user.birthday?e.inputFields[3].data=N.user.birthday.substr(0,10):e.inputFields[3].data="Дата не указана",e.inputFields[4].data=N.user.status,N.editStatus&&N.editMsg?(g.errorInfo.errorText=N.editMsg,g.errorInfo.errorClass="display-inline-grid font-color-ok"):!N.editStatus&&N.editMsg?(g.errorInfo.errorText=N.editMsg,g.errorInfo.errorClass="display-inline-grid font-color-error"):(g.errorInfo.errorText="",g.errorInfo.errorClass="display-none"),this._context={sideBarData:l,headerData:t,settingsPathData:g},document.title="Настройки"}},SafetyView:new class extends M{constructor(){super(),this._addHandlebarsPartial(),this._jsId="safety",this.curPage=!1,this._validatePassword=!0,this._validatePasswordNew=!1,this._validatePasswordRepeat=!0,j.registerCallback(this.updatePage.bind(this)),N.registerCallback(this.updatePage.bind(this))}_addHandlebarsPartial(){Handlebars.registerPartial("inputField",Handlebars.templates.inputField),Handlebars.registerPartial("button",Handlebars.templates.button),Handlebars.registerPartial("sideBar",Handlebars.templates.sideBar),Handlebars.registerPartial("header",Handlebars.templates.header),Handlebars.registerPartial("menuItem",Handlebars.templates.menuItem)}_addPagesElements(){super.addPagesElements(),this._exitBtn=document.getElementById("js-exit-btn"),this._settingsBtn=document.getElementById("js-settings-btn"),this._settingsBtn=document.getElementById("js-menu-main"),this._safetyBtn=document.getElementById("js-menu-safety"),this._safetyBtn.style.color=i,this._feedBtn=document.getElementById("js-logo-go-feed"),this._passwordField=document.getElementById("js-password-input"),this._passwordErrorField=document.getElementById("js-password-error"),this._passwordNewField=document.getElementById("js-new-password-input"),this._passwordNewErrorField=document.getElementById("js-new-password-error"),this._passwordRepeatField=document.getElementById("js-repeat-password-input"),this._passwordRepeatErrorField=document.getElementById("js-repeat-password-error"),this._saveBtn=document.getElementById("js-change-password-btn"),this._groupsItem=document.getElementById("js-side-bar-groups"),this._myPageItem=document.getElementById("js-side-bar-my-page"),this._newsItem=document.getElementById("js-side-bar-news"),this._msgItem=document.getElementById("js-side-bar-msg"),this._photoItem=document.getElementById("js-side-bar-photo"),this._friendsItem=document.getElementById("js-side-bar-friends"),this._groupsItem=document.getElementById("js-side-bar-groups"),this._bookmarksItem=document.getElementById("js-side-bar-bookmarks"),this._saveInfo=document.getElementById("js-save-password-info")}_addPagesListener(){super.addPagesListener(),this._exitBtn.addEventListener("click",(()=>{E.signOut()})),this._groupsItem.addEventListener("click",(()=>{t.go("/groups",!1)})),this._settingsBtn.addEventListener("click",(()=>{t.go("/settings",!1)})),this._safetyBtn.addEventListener("click",(()=>{t.go("/safety",!1)})),this._friendsItem.addEventListener("click",(()=>{t.go("/friends",!1)})),this._msgItem.addEventListener("click",(()=>{t.go("/message",!1)})),this._myPageItem.addEventListener("click",(()=>{t.go("/user",!1)})),this._newsItem.addEventListener("click",(()=>{t.go("/feed",!1)})),this._feedBtn.addEventListener("click",(()=>{t.go("/feed",!1)})),this._saveBtn.addEventListener("click",(()=>{this._validatePassword&&this._validatePasswordNew&&this._validatePasswordRepeat&&(E.editProfile({password:this._passwordNewField.value}),this._saveInfo.textContent="Изменения сохранены")})),this._passwordField.addEventListener("change",(()=>{})),this._passwordNewField.addEventListener("change",(()=>{this._validatePasswordNew=F.validation(this._passwordNewField,this._passwordNewErrorField,"password","settings")})),this._passwordRepeatField.addEventListener("change",(()=>{}))}remove(){document.getElementById(this._jsId)?.remove()}updatePage(){this.curPage&&(N.user.isAuth?this._render():t.go("/sign-in"))}showPage(){E.getProfile((()=>{x.getNotifiesCount(!0)}))}_preRender(){this._template=Handlebars.templates.safety;let t=d;t.avatar_url=N.user.avatar_url,this._context={sideBarData:l,headerData:t,safetyPathData:_},document.title="Настройки безопасности"}_render(){this._preRender(),t.rootElement.innerHTML=this._template(this._context),this._addPagesElements(),this._addPagesListener()}},MessagesView:new class extends M{constructor(){super(),this._jsId="messages",this.curPage=!1}addStore(){j.registerCallback(this.updatePage.bind(this)),N.registerCallback(this.updatePage.bind(this))}addPagesElements(){super.addPagesElements(),this._msgItem.style.color=i,this._msgImg.style.display="none",this._msgImgActive.style.display="inline-block",this._groupsItem=document.getElementById("js-side-bar-groups"),this._goToMsg=document.getElementsByClassName("js-go-chat")}addPagesListener(){super.addPagesListener();for(let e=0;e<this._goToMsg.length;e++)this._goToMsg[e].addEventListener("click",(()=>{const s=this._goToMsg[e].getAttribute("data-id");localStorage.setItem("chatId",s),S.getChatsMsg(null,s,15),t.go("/chat",!1)}))}showPage(){E.getProfile((()=>{S.getChats(100),x.getNotifiesCount(!0)}))}_preRender(){this._template=Handlebars.templates.messages;let t=d;t.avatar_url=N.user.avatar_url,this._context={sideBarData:l,headerData:t,textInfo:{textInfo:"У вас пока нет чатов"},messagesData:j.chats},document.title="Мессенджер"}},ChatView:new class extends M{constructor(){super(),this._jsId="chat",this._curMsg="",this._messageBatchSize=20}addStore(){j.registerCallback(this.updatePage.bind(this)),N.registerCallback(this.updatePage.bind(this)),C.registerCallback(this.updatePage.bind(this)),O.registerCallback(this.updatePage.bind(this))}addPagesElements(){super.addPagesElements(),this._backBtn=document.getElementById("js-back-to-messages-btn"),this._sendMsg=document.getElementById("js-send-msg"),this._sendMsgBlock=document.getElementById("js-send-msg-block"),this._msg=document.getElementById("js-msg-input"),this._smiles=document.getElementsByClassName("js-smile"),this._stickers=document.getElementsByClassName("js-sticker"),this._smilesBtn=document.getElementsByClassName("smiles-keyboard-icon_smiles"),this._smilesFrame=document.getElementsByClassName("smiles"),this._smilesImg=document.getElementById("js-smiles"),this._smilesImgActive=document.getElementById("js-smiles-active"),this._stickersBtn=document.getElementsByClassName("smiles-keyboard-icon_stickers"),this._stickersFrame=document.getElementsByClassName("stickers"),this._stickersImg=document.getElementById("js-stickers"),this._stickersImgActive=document.getElementById("js-stickers-active"),this._emotionBtn=document.getElementById("js-chat-smiles"),this._emotionKeyboard=document.getElementById("js-smiles-keyboard"),this._install=document.getElementsByClassName("js-file-i"),this._msgError=document.getElementById("js-msg-error"),this._smilesImg.style.display="none",this._smilesImgActive.style.display="block",this._msg.focus(),this._msgList=document.getElementById("js-1"),this._msgList.scrollTop=this._msgList.scrollHeight,this._textarea=document.getElementsByTagName("textarea"),this._textarea[0].setAttribute("style","height:"+this._textarea[0].scrollHeight),this._textarea[0].addEventListener("input",(function(){this.style.height="auto",this.style.height=this.scrollHeight+"px"}),!1),this._addPhotoToMsg=document.getElementById("js-add-photo-to-msg"),this._removeImg=document.getElementsByClassName("js-delete-photo-from-msg")}addPagesListener(){this._msg.setSelectionRange(this._msg.textContent.length,this._msg.textContent.length),super.addPagesListener(),this._backBtn.addEventListener("click",(()=>{C.attachments=[],O.editError="",this._msgError.textContent="",t.goBack()})),this._sendMsg.addEventListener("click",(()=>{if(this._msg.value.length||C.attachments.length){if(localStorage.setItem("curMsg",""),C.attachments.length){let t=[];C.attachments.forEach((e=>{"file"===e.type?t.push(s.imgUrlBackConvert(e.url)+`&filename=${e.filename}`):t.push(s.imgUrlBackConvert(e.url))})),C.attachments=[],S.msgSend(localStorage.getItem("chatId"),this._msg.value,null,t)}else S.msgSend(localStorage.getItem("chatId"),this._msg.value);this._msg.value=""}})),this._msgList.addEventListener("scroll",(()=>{this._msgList.scrollTop<=0&&!this.watingForNewPosts&&j.hasNextMessages&&(S.getChatsMsg(null,localStorage.getItem("chatId"),this._messageBatchSize,j.messages.at(0).raw_creation_date,!0),this.watingForNewPosts=!0)})),this._msg.addEventListener("input",(t=>{O.editError="",this._msgError.textContent="",t.target.value.length?(this._sendMsg.classList.remove("display-none"),this._sendMsgBlock.classList.add("display-none")):(this._sendMsg.classList.add("display-none"),this._sendMsgBlock.classList.remove("display-none"))})),this._msg.addEventListener("keydown",(function(t){"Enter"!==t.key||t.shiftKey||(t.preventDefault(),document.getElementById("js-send-msg").click())})),this._addPhotoToMsg&&this._addPhotoToMsg.addEventListener("click",(()=>{if(null===C.attachments&&(C.attachments=[]),C.attachments.length>=10)return;localStorage.setItem("curMsg",this._msg.value);const e=document.createElement("input");e.type="file",e.addEventListener("change",(function(e){const i=e.target.files[0],a=new FileReader;a.onload=()=>{q.uploadImg(i,(e=>{let a=1;C.attachments.length&&(a=C.attachments[C.attachments.length-1].id+1),"img"===t._getSearch(e).type?C.attachments.push({url:s.imgUrlConvert(e),id:a,type:"img"}):C.attachments.push({url:s.imgUrlConvert(e),id:a,type:"file",filename:i.name}),C._refreshStore()}))},a.readAsDataURL(i)})),e.click()}));for(let t=0;t<this._removeImg.length;t++)this._removeImg[t].addEventListener("click",(()=>{const e=this._removeImg[t].getAttribute("data-id");let s=-1;for(let t=0;t<C.attachments.length;t++)if(C.attachments[t].id.toString()===e){s=t;break}s>-1&&C.attachments.splice(s,1),O.editError="",this._msgError.textContent="",localStorage.setItem("curMsg",this._msg.value),C._refreshStore()}));for(let t=0;t<this._smilesBtn.length;t++)this._smilesBtn[t].addEventListener("click",(()=>{for(let t=0;t<this._stickersFrame.length;t++)this._stickersFrame[t].style.display="none";for(let t=0;t<this._smilesFrame.length;t++)this._smilesFrame[t].style.display="block";this._smilesImg.style.display="none",this._smilesImgActive.style.display="block",this._stickersImg.style.display="block",this._stickersImgActive.style.display="none",this._msg.focus()}));for(let t=0;t<this._stickersBtn.length;t++)this._stickersBtn[t].addEventListener("click",(()=>{for(let t=0;t<this._smilesFrame.length;t++)this._smilesFrame[t].style.display="none";for(let t=0;t<this._stickersFrame.length;t++)this._stickersFrame[t].style.display="block";this._stickersImg.style.display="none",this._stickersImgActive.style.display="block",this._smilesImg.style.display="block",this._smilesImgActive.style.display="none",this._msg.focus()}));this._emotionBtn.addEventListener("click",(()=>{"block"===this._emotionKeyboard.style.display?this._emotionKeyboard.style.display="none":this._emotionKeyboard.style.display="block",O.editError="",this._msgError.textContent="",this._msg.focus()}));for(let t=0;t<this._smiles.length;t++)this._smiles[t].addEventListener("click",(()=>{const e=this._smiles[t].innerText||this._smiles[t].textContent;this._msg.value+=e,this._msg.dispatchEvent(new Event("input"))}));for(let t=0;t<this._stickers.length;t++)this._stickers[t].addEventListener("click",(()=>{localStorage.setItem("curMsg",""),S.msgSend(localStorage.getItem("chatId"),"",parseInt(this._stickers[t].getAttribute("data-id")))}));for(let t=0;t<this._install.length;t++)this._install[t].addEventListener("click",(()=>{const e=this._install[t].getAttribute("data-id");window.open(e,"_blank")}));this._msg.value||C.attachments.length?(this._sendMsg.classList.remove("display-none"),this._sendMsgBlock.classList.add("display-none")):(this._sendMsg.classList.add("display-none"),this._sendMsgBlock.classList.remove("display-none"))}showPage(){const e=localStorage.getItem("chatId");C.attachments=[],e?(E.getProfile((()=>{S.getChatsMsg((()=>{S.msgRead(localStorage.getItem("chatId"),j.messages.slice(0)[0].creation_date_read)}),e,this._messageBatchSize),S.getChats(15),x.getNotifiesCount(!0)})),$.getStickerPacksByAuthor(15,0)):t.goBack()}_preRender(){this.watingForNewPosts=!1;let t=null;j.chats.forEach((e=>{String(e.chat_id)===localStorage.getItem("chatId")&&(t=e)}));let e=null;t&&(e=t.members[0],t.members[0].user_link===N.user.user_link&&1!==t.members.length&&(e=t.members[1])),this._template=Handlebars.templates.chatPage;let s=d;s.avatar_url=N.user.avatar_url,this._context={sideBarData:l,headerData:s,chatData:{messages:j.messages,myError:O.editError,attachments:C.attachments,user:e,chat:t,curMsg:localStorage.getItem("curMsg"),keyboardData:{smiles:k,stickerpacks:{stickerpacks:R.stickerPacks}}}},document.title="Мессенджер"}},NotFoundView:new class{constructor(){this._addHandlebarsPartial(),this._jsId="not-found",this.curPage=!1}_addHandlebarsPartial(){Handlebars.registerPartial("notFound",Handlebars.templates.notFound)}remove(){document.getElementById(this._jsId)?.remove()}showPage(){this._render()}_preRender(){this._context={code:"404",text:"Страница не найдена"},document.title="404"}_render(){this._preRender(),this._template=Handlebars.templates.notFound,t.rootElement.innerHTML=this._template(this._context)}}};t.registerPage("/",z.FeedView),t.registerPage("/feed",z.FeedView),t.registerPage("/sign-in",z.SignInView),t.registerPage("/sign-up",z.SignUpView),t.registerPage("/friends",z.FriendsView),t.registerPage("/groups",z.GroupsView),t.registerPage("/subscribers",z.FriendsView),t.registerPage("/subscriptions",z.FriendsView),t.registerPage("/find-friends",z.FriendsView),t.registerPage("/group",z.GroupView),t.registerPage("/groups",z.GroupsView),t.registerPage("/manage-groups",z.GroupsView),t.registerPage("/find-groups",z.GroupsView),t.registerPage("/popular-groups",z.GroupsView),t.registerPage("/my-page",z.ProfileView),t.registerPage("/user",z.ProfileView),t.registerPage("/settings-group",z.SettingsGroupView),t.registerPage("/settings",z.SettingsView),t.registerPage("/safety",z.SafetyView),t.registerPage("/message",z.MessagesView),t.registerPage("/chat",z.ChatView),t.registerPage("/404",z.NotFoundView),E.checkAuth((()=>{t.init()}))}();
